/* Version: 1.2.20 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).ScSoftHandler={})}(this,(function(e){"use strict";function t(e,t){return t.forEach((function(t){t&&"string"!=typeof t&&!Array.isArray(t)&&Object.keys(t).forEach((function(r){if("default"!==r&&!(r in e)){var n=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(e,r,n.get?n:{enumerable:!0,get:function(){return t[r]}})}}))})),Object.freeze(e)}var r;function n(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){return function(e,t){if(t.get)return t.get.call(e);return t.value}(e,a(e,t,"get"))}function i(e,t,r){return function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=r}}(e,a(e,t,"set"),r),r}function a(e,t,r){if(!t.has(e))throw new TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}function s(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return r}function c(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function d(e,t,r){c(e,t),t.set(e,r)}function l(e,t){c(e,t),t.add(e)}e.SoftHandlerEvent=void 0,(r=e.SoftHandlerEvent||(e.SoftHandlerEvent={})).AUTO_REG="register/autoRegister",r.REG_RESULT="registerResult",r.UNREG_RESULT="unregisterResult",r.ERROR="error",r.IN_CALL="incomingcall",r.IN_CALL_ANSWER="incomingcall/autoAnswer",r.RINGING="ringing",r.ACCEPTED="accepted",r.HANGUP="hangup",r.HANGUP_RESULT="hangupResult",r.CALL_RESULT="callingResult",r.ANSWER_RESULT="answerResult";var u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},p=function(e){return e&&e.Math==Math&&e},f=p("object"==typeof globalThis&&globalThis)||p("object"==typeof window&&window)||p("object"==typeof self&&self)||p("object"==typeof u&&u)||function(){return this}()||Function("return this")(),h="object"==typeof document&&document.all,m={all:h,IS_HTMLDDA:void 0===h&&void 0!==h},v=m.all,g=m.IS_HTMLDDA?function(e){return"function"==typeof e||e===v}:function(e){return"function"==typeof e},y=g,b=m.all,S=m.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:y(e)||e===b}:function(e){return"object"==typeof e?null!==e:y(e)},w=S,C=f.document,T=w(C)&&w(C.createElement),R=function(e){return T?C.createElement(e):{}},k=R("span").classList,P=k&&k.constructor&&k.constructor.prototype,E=P===Object.prototype?void 0:P,D=function(e){try{return!!e()}catch(e){return!0}},I=!D((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})),A=I,O=Function.prototype,x=O.call,_=A&&O.bind.bind(x,x),j=A?_:function(e){return function(){return x.apply(e,arguments)}},M=j,L=M({}.toString),U=M("".slice),V=function(e){return U(L(e),8,-1)},N=D,F=V,H=Object,G=j("".split),z=N((function(){return!H("z").propertyIsEnumerable(0)}))?function(e){return"String"==F(e)?G(e,""):H(e)}:H,J=function(e){return null==e},W=J,q=TypeError,B=function(e){if(W(e))throw q("Can't call method on "+e);return e},$=z,K=B,Y=function(e){return $(K(e))},Q={},X={get exports(){return Q},set exports(e){Q=e}},Z=f,ee=Object.defineProperty,te=function(e,t){try{ee(Z,e,{value:t,configurable:!0,writable:!0})}catch(r){Z[e]=t}return t},re=te,ne="__core-js_shared__",oe=f[ne]||re(ne,{}),ie=oe;(X.exports=function(e,t){return ie[e]||(ie[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.26.1",mode:"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.1/LICENSE",source:"https://github.com/zloirock/core-js"});var ae,se,ce=B,de=Object,le=function(e){return de(ce(e))},ue=le,pe=j({}.hasOwnProperty),fe=Object.hasOwn||function(e,t){return pe(ue(e),t)},he=j,me=0,ve=Math.random(),ge=he(1..toString),ye=function(e){return"Symbol("+(void 0===e?"":e)+")_"+ge(++me+ve,36)},be=f,Se=g,we=function(e){return Se(e)?e:void 0},Ce=function(e,t){return arguments.length<2?we(be[e]):be[e]&&be[e][t]},Te=f,Re=Ce("navigator","userAgent")||"",ke=Te.process,Pe=Te.Deno,Ee=ke&&ke.versions||Pe&&Pe.version,De=Ee&&Ee.v8;De&&(se=(ae=De.split("."))[0]>0&&ae[0]<4?1:+(ae[0]+ae[1])),!se&&Re&&(!(ae=Re.match(/Edge\/(\d+)/))||ae[1]>=74)&&(ae=Re.match(/Chrome\/(\d+)/))&&(se=+ae[1]);var Ie=se,Ae=D,Oe=!!Object.getOwnPropertySymbols&&!Ae((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Ie&&Ie<41})),xe=Oe&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,_e=f,je=fe,Me=ye,Le=Oe,Ue=xe,Ve=Q("wks"),Ne=_e.Symbol,Fe=Ne&&Ne.for,He=Ue?Ne:Ne&&Ne.withoutSetter||Me,Ge=function(e){if(!je(Ve,e)||!Le&&"string"!=typeof Ve[e]){var t="Symbol."+e;Le&&je(Ne,e)?Ve[e]=Ne[e]:Ve[e]=Ue&&Fe?Fe(t):He(t)}return Ve[e]},ze=S,Je=String,We=TypeError,qe=function(e){if(ze(e))return e;throw We(Je(e)+" is not an object")},Be={},$e=!D((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),Ke=$e&&D((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Ye={},Qe=R,Xe=!$e&&!D((function(){return 7!=Object.defineProperty(Qe("div"),"a",{get:function(){return 7}}).a})),Ze=I,et=Function.prototype.call,tt=Ze?et.bind(et):function(){return et.apply(et,arguments)},rt=j({}.isPrototypeOf),nt=Ce,ot=g,it=rt,at=Object,st=xe?function(e){return"symbol"==typeof e}:function(e){var t=nt("Symbol");return ot(t)&&it(t.prototype,at(e))},ct=String,dt=function(e){try{return ct(e)}catch(e){return"Object"}},lt=g,ut=dt,pt=TypeError,ft=function(e){if(lt(e))return e;throw pt(ut(e)+" is not a function")},ht=ft,mt=J,vt=function(e,t){var r=e[t];return mt(r)?void 0:ht(r)},gt=tt,yt=g,bt=S,St=TypeError,wt=tt,Ct=S,Tt=st,Rt=vt,kt=function(e,t){var r,n;if("string"===t&&yt(r=e.toString)&&!bt(n=gt(r,e)))return n;if(yt(r=e.valueOf)&&!bt(n=gt(r,e)))return n;if("string"!==t&&yt(r=e.toString)&&!bt(n=gt(r,e)))return n;throw St("Can't convert object to primitive value")},Pt=TypeError,Et=Ge("toPrimitive"),Dt=function(e,t){if(!Ct(e)||Tt(e))return e;var r,n=Rt(e,Et);if(n){if(void 0===t&&(t="default"),r=wt(n,e,t),!Ct(r)||Tt(r))return r;throw Pt("Can't convert object to primitive value")}return void 0===t&&(t="number"),kt(e,t)},It=st,At=function(e){var t=Dt(e,"string");return It(t)?t:t+""},Ot=$e,xt=Xe,_t=Ke,jt=qe,Mt=At,Lt=TypeError,Ut=Object.defineProperty,Vt=Object.getOwnPropertyDescriptor,Nt="enumerable",Ft="configurable",Ht="writable";Ye.f=Ot?_t?function(e,t,r){if(jt(e),t=Mt(t),jt(r),"function"==typeof e&&"prototype"===t&&"value"in r&&Ht in r&&!r[Ht]){var n=Vt(e,t);n&&n[Ht]&&(e[t]=r.value,r={configurable:Ft in r?r[Ft]:n[Ft],enumerable:Nt in r?r[Nt]:n[Nt],writable:!1})}return Ut(e,t,r)}:Ut:function(e,t,r){if(jt(e),t=Mt(t),jt(r),xt)try{return Ut(e,t,r)}catch(e){}if("get"in r||"set"in r)throw Lt("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var Gt=Math.ceil,zt=Math.floor,Jt=Math.trunc||function(e){var t=+e;return(t>0?zt:Gt)(t)},Wt=function(e){var t=+e;return t!=t||0===t?0:Jt(t)},qt=Wt,Bt=Math.max,$t=Math.min,Kt=function(e,t){var r=qt(e);return r<0?Bt(r+t,0):$t(r,t)},Yt=Wt,Qt=Math.min,Xt=function(e){return e>0?Qt(Yt(e),9007199254740991):0},Zt=Xt,er=function(e){return Zt(e.length)},tr=Y,rr=Kt,nr=er,or=function(e){return function(t,r,n){var o,i=tr(t),a=nr(i),s=rr(n,a);if(e&&r!=r){for(;a>s;)if((o=i[s++])!=o)return!0}else for(;a>s;s++)if((e||s in i)&&i[s]===r)return e||s||0;return!e&&-1}},ir={includes:or(!0),indexOf:or(!1)},ar={},sr=fe,cr=Y,dr=ir.indexOf,lr=ar,ur=j([].push),pr=function(e,t){var r,n=cr(e),o=0,i=[];for(r in n)!sr(lr,r)&&sr(n,r)&&ur(i,r);for(;t.length>o;)sr(n,r=t[o++])&&(~dr(i,r)||ur(i,r));return i},fr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],hr=pr,mr=fr,vr=Object.keys||function(e){return hr(e,mr)},gr=$e,yr=Ke,br=Ye,Sr=qe,wr=Y,Cr=vr;Be.f=gr&&!yr?Object.defineProperties:function(e,t){Sr(e);for(var r,n=wr(t),o=Cr(t),i=o.length,a=0;i>a;)br.f(e,r=o[a++],n[r]);return e};var Tr,Rr=Ce("document","documentElement"),kr=ye,Pr=Q("keys"),Er=function(e){return Pr[e]||(Pr[e]=kr(e))},Dr=qe,Ir=Be,Ar=fr,Or=ar,xr=Rr,_r=R,jr="prototype",Mr="script",Lr=Er("IE_PROTO"),Ur=function(){},Vr=function(e){return"<"+Mr+">"+e+"</"+Mr+">"},Nr=function(e){e.write(Vr("")),e.close();var t=e.parentWindow.Object;return e=null,t},Fr=function(){try{Tr=new ActiveXObject("htmlfile")}catch(e){}var e,t,r;Fr="undefined"!=typeof document?document.domain&&Tr?Nr(Tr):(t=_r("iframe"),r="java"+Mr+":",t.style.display="none",xr.appendChild(t),t.src=String(r),(e=t.contentWindow.document).open(),e.write(Vr("document.F=Object")),e.close(),e.F):Nr(Tr);for(var n=Ar.length;n--;)delete Fr[jr][Ar[n]];return Fr()};Or[Lr]=!0;var Hr=Object.create||function(e,t){var r;return null!==e?(Ur[jr]=Dr(e),r=new Ur,Ur[jr]=null,r[Lr]=e):r=Fr(),void 0===t?r:Ir.f(r,t)},Gr=Ge,zr=Hr,Jr=Ye.f,Wr=Gr("unscopables"),qr=Array.prototype;null==qr[Wr]&&Jr(qr,Wr,{configurable:!0,value:zr(null)});var Br,$r,Kr,Yr={},Qr=g,Xr=f.WeakMap,Zr=Qr(Xr)&&/native code/.test(String(Xr)),en=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},tn=Ye,rn=en,nn=$e?function(e,t,r){return tn.f(e,t,rn(1,r))}:function(e,t,r){return e[t]=r,e},on=Zr,an=f,sn=S,cn=nn,dn=fe,ln=oe,un=Er,pn=ar,fn="Object already initialized",hn=an.TypeError,mn=an.WeakMap;if(on||ln.state){var vn=ln.state||(ln.state=new mn);vn.get=vn.get,vn.has=vn.has,vn.set=vn.set,Br=function(e,t){if(vn.has(e))throw hn(fn);return t.facade=e,vn.set(e,t),t},$r=function(e){return vn.get(e)||{}},Kr=function(e){return vn.has(e)}}else{var gn=un("state");pn[gn]=!0,Br=function(e,t){if(dn(e,gn))throw hn(fn);return t.facade=e,cn(e,gn,t),t},$r=function(e){return dn(e,gn)?e[gn]:{}},Kr=function(e){return dn(e,gn)}}var yn={set:Br,get:$r,has:Kr,enforce:function(e){return Kr(e)?$r(e):Br(e,{})},getterFor:function(e){return function(t){var r;if(!sn(t)||(r=$r(t)).type!==e)throw hn("Incompatible receiver, "+e+" required");return r}}},bn={},Sn={},wn={}.propertyIsEnumerable,Cn=Object.getOwnPropertyDescriptor,Tn=Cn&&!wn.call({1:2},1);Sn.f=Tn?function(e){var t=Cn(this,e);return!!t&&t.enumerable}:wn;var Rn=$e,kn=tt,Pn=Sn,En=en,Dn=Y,In=At,An=fe,On=Xe,xn=Object.getOwnPropertyDescriptor;bn.f=Rn?xn:function(e,t){if(e=Dn(e),t=In(t),On)try{return xn(e,t)}catch(e){}if(An(e,t))return En(!kn(Pn.f,e,t),e[t])};var _n={},jn={get exports(){return _n},set exports(e){_n=e}},Mn=$e,Ln=fe,Un=Function.prototype,Vn=Mn&&Object.getOwnPropertyDescriptor,Nn=Ln(Un,"name"),Fn={EXISTS:Nn,PROPER:Nn&&"something"===function(){}.name,CONFIGURABLE:Nn&&(!Mn||Mn&&Vn(Un,"name").configurable)},Hn=g,Gn=oe,zn=j(Function.toString);Hn(Gn.inspectSource)||(Gn.inspectSource=function(e){return zn(e)});var Jn=Gn.inspectSource,Wn=D,qn=g,Bn=fe,$n=$e,Kn=Fn.CONFIGURABLE,Yn=Jn,Qn=yn.enforce,Xn=yn.get,Zn=Object.defineProperty,eo=$n&&!Wn((function(){return 8!==Zn((function(){}),"length",{value:8}).length})),to=String(String).split("String"),ro=jn.exports=function(e,t,r){"Symbol("===String(t).slice(0,7)&&(t="["+String(t).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!Bn(e,"name")||Kn&&e.name!==t)&&($n?Zn(e,"name",{value:t,configurable:!0}):e.name=t),eo&&r&&Bn(r,"arity")&&e.length!==r.arity&&Zn(e,"length",{value:r.arity});try{r&&Bn(r,"constructor")&&r.constructor?$n&&Zn(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var n=Qn(e);return Bn(n,"source")||(n.source=to.join("string"==typeof t?t:"")),e};Function.prototype.toString=ro((function(){return qn(this)&&Xn(this).source||Yn(this)}),"toString");var no=g,oo=Ye,io=_n,ao=te,so=function(e,t,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:t;if(no(r)&&io(r,i,n),n.global)o?e[t]=r:ao(t,r);else{try{n.unsafe?e[t]&&(o=!0):delete e[t]}catch(e){}o?e[t]=r:oo.f(e,t,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return e},co={},lo=pr,uo=fr.concat("length","prototype");co.f=Object.getOwnPropertyNames||function(e){return lo(e,uo)};var po={};po.f=Object.getOwnPropertySymbols;var fo,ho,mo,vo=Ce,go=co,yo=po,bo=qe,So=j([].concat),wo=vo("Reflect","ownKeys")||function(e){var t=go.f(bo(e)),r=yo.f;return r?So(t,r(e)):t},Co=fe,To=wo,Ro=bn,ko=Ye,Po=D,Eo=g,Do=/#|\.prototype\./,Io=function(e,t){var r=Oo[Ao(e)];return r==_o||r!=xo&&(Eo(t)?Po(t):!!t)},Ao=Io.normalize=function(e){return String(e).replace(Do,".").toLowerCase()},Oo=Io.data={},xo=Io.NATIVE="N",_o=Io.POLYFILL="P",jo=Io,Mo=f,Lo=bn.f,Uo=nn,Vo=so,No=te,Fo=function(e,t,r){for(var n=To(t),o=ko.f,i=Ro.f,a=0;a<n.length;a++){var s=n[a];Co(e,s)||r&&Co(r,s)||o(e,s,i(t,s))}},Ho=jo,Go=function(e,t){var r,n,o,i,a,s=e.target,c=e.global,d=e.stat;if(r=c?Mo:d?Mo[s]||No(s,{}):(Mo[s]||{}).prototype)for(n in t){if(i=t[n],o=e.dontCallGetSet?(a=Lo(r,n))&&a.value:r[n],!Ho(c?n:s+(d?".":"#")+n,e.forced)&&void 0!==o){if(typeof i==typeof o)continue;Fo(i,o)}(e.sham||o&&o.sham)&&Uo(i,"sham",!0),Vo(r,n,i,e)}},zo=!D((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),Jo=fe,Wo=g,qo=le,Bo=zo,$o=Er("IE_PROTO"),Ko=Object,Yo=Ko.prototype,Qo=Bo?Ko.getPrototypeOf:function(e){var t=qo(e);if(Jo(t,$o))return t[$o];var r=t.constructor;return Wo(r)&&t instanceof r?r.prototype:t instanceof Ko?Yo:null},Xo=D,Zo=g,ei=S,ti=Qo,ri=so,ni=Ge("iterator"),oi=!1;[].keys&&("next"in(mo=[].keys())?(ho=ti(ti(mo)))!==Object.prototype&&(fo=ho):oi=!0);var ii=!ei(fo)||Xo((function(){var e={};return fo[ni].call(e)!==e}));ii&&(fo={}),Zo(fo[ni])||ri(fo,ni,(function(){return this}));var ai={IteratorPrototype:fo,BUGGY_SAFARI_ITERATORS:oi},si=Ye.f,ci=fe,di=Ge("toStringTag"),li=function(e,t,r){e&&!r&&(e=e.prototype),e&&!ci(e,di)&&si(e,di,{configurable:!0,value:t})},ui=ai.IteratorPrototype,pi=Hr,fi=en,hi=li,mi=Yr,vi=function(){return this},gi=function(e,t,r,n){var o=t+" Iterator";return e.prototype=pi(ui,{next:fi(+!n,r)}),hi(e,o,!1),mi[o]=vi,e},yi=g,bi=String,Si=TypeError,wi=j,Ci=qe,Ti=function(e){if("object"==typeof e||yi(e))return e;throw Si("Can't set "+bi(e)+" as a prototype")},Ri=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=wi(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return Ci(r),Ti(n),t?e(r,n):r.__proto__=n,r}}():void 0),ki=Go,Pi=tt,Ei=g,Di=gi,Ii=Qo,Ai=Ri,Oi=li,xi=nn,_i=so,ji=Yr,Mi=Fn.PROPER,Li=Fn.CONFIGURABLE,Ui=ai.IteratorPrototype,Vi=ai.BUGGY_SAFARI_ITERATORS,Ni=Ge("iterator"),Fi="keys",Hi="values",Gi="entries",zi=function(){return this},Ji=function(e,t,r,n,o,i,a){Di(r,t,n);var s,c,d,l=function(e){if(e===o&&m)return m;if(!Vi&&e in f)return f[e];switch(e){case Fi:case Hi:case Gi:return function(){return new r(this,e)}}return function(){return new r(this)}},u=t+" Iterator",p=!1,f=e.prototype,h=f[Ni]||f["@@iterator"]||o&&f[o],m=!Vi&&h||l(o),v="Array"==t&&f.entries||h;if(v&&(s=Ii(v.call(new e)))!==Object.prototype&&s.next&&(Ii(s)!==Ui&&(Ai?Ai(s,Ui):Ei(s[Ni])||_i(s,Ni,zi)),Oi(s,u,!0)),Mi&&o==Hi&&h&&h.name!==Hi&&(Li?xi(f,"name",Hi):(p=!0,m=function(){return Pi(h,this)})),o)if(c={values:l(Hi),keys:i?m:l(Fi),entries:l(Gi)},a)for(d in c)(Vi||p||!(d in f))&&_i(f,d,c[d]);else ki({target:t,proto:!0,forced:Vi||p},c);return f[Ni]!==m&&_i(f,Ni,m,{name:o}),ji[t]=m,c},Wi=function(e,t){return{value:e,done:t}},qi=Y,Bi=function(e){qr[Wr][e]=!0},$i=Yr,Ki=yn,Yi=Ye.f,Qi=Ji,Xi=Wi,Zi=$e,ea="Array Iterator",ta=Ki.set,ra=Ki.getterFor(ea),na=Qi(Array,"Array",(function(e,t){ta(this,{type:ea,target:qi(e),index:0,kind:t})}),(function(){var e=ra(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,Xi(void 0,!0)):Xi("keys"==r?n:"values"==r?t[n]:[n,t[n]],!1)}),"values"),oa=$i.Arguments=$i.Array;if(Bi("keys"),Bi("values"),Bi("entries"),Zi&&"values"!==oa.name)try{Yi(oa,"name",{value:"values"})}catch(e){}var ia=f,aa={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},sa=E,ca=na,da=nn,la=Ge,ua=la("iterator"),pa=la("toStringTag"),fa=ca.values,ha=function(e,t){if(e){if(e[ua]!==fa)try{da(e,ua,fa)}catch(t){e[ua]=fa}if(e[pa]||da(e,pa,t),aa[t])for(var r in ca)if(e[r]!==ca[r])try{da(e,r,ca[r])}catch(t){e[r]=ca[r]}}};for(var ma in aa)ha(ia[ma]&&ia[ma].prototype,ma);ha(sa,"DOMTokenList");const va={SHANDLE_FAILED_CODE:{1001:"账号或密码错误",1002:"该帐号已连接",1004:"没有鉴权",9001:"SIP号码已注册,抢注册失败",404:"没有找到对应的设备",408:"呼叫超时",486:"对方正忙",487:"对方挂断",488:"对方拒绝"}},ga=Object.freeze({configs:{janusUrl:"",autoRegister:!0,ringFile:""},registerInfo:{username:"",displayName:"",sipServerIp:"127.0.0.1",sipServerPort:5060}}),ya=Object.freeze({audioSend:!0,audioRecv:!0,videoSend:!1,videoRecv:!1}),ba="incomingcall",Sa="ringing",wa="accepted",Ca="hangup",Ta="hangingup",Ra="registration_failed",ka="registered",Pa="unregistering",Ea="calling",Da="accept_reply",Ia="new_accepted",Aa="updating";var Oa={};Oa[Ge("toStringTag")]="z";var xa,_a,ja="[object z]"===String(Oa),Ma=g,La=V,Ua=Ge("toStringTag"),Va=Object,Na="Arguments"==La(function(){return arguments}()),Fa=ja?La:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Va(e),Ua))?r:Na?La(t):"Object"==(n=La(t))&&Ma(t.callee)?"Arguments":n},Ha=Fa,Ga=String,za=function(e){if("Symbol"===Ha(e))throw TypeError("Cannot convert a Symbol value to a string");return Ga(e)},Ja=qe,Wa=D,qa=f.RegExp,Ba=Wa((function(){var e=qa("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),$a=Ba||Wa((function(){return!qa("a","y").sticky})),Ka={BROKEN_CARET:Ba||Wa((function(){var e=qa("^r","gy");return e.lastIndex=2,null!=e.exec("str")})),MISSED_STICKY:$a,UNSUPPORTED_Y:Ba},Ya=D,Qa=f.RegExp,Xa=Ya((function(){var e=Qa(".","s");return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),Za=D,es=f.RegExp,ts=Za((function(){var e=es("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),rs=tt,ns=j,os=za,is=function(){var e=Ja(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},as=Ka,ss=Hr,cs=yn.get,ds=Xa,ls=ts,us=Q("native-string-replace",String.prototype.replace),ps=RegExp.prototype.exec,fs=ps,hs=ns("".charAt),ms=ns("".indexOf),vs=ns("".replace),gs=ns("".slice),ys=(_a=/b*/g,rs(ps,xa=/a/,"a"),rs(ps,_a,"a"),0!==xa.lastIndex||0!==_a.lastIndex),bs=as.BROKEN_CARET,Ss=void 0!==/()??/.exec("")[1];(ys||Ss||bs||ds||ls)&&(fs=function(e){var t,r,n,o,i,a,s,c=this,d=cs(c),l=os(e),u=d.raw;if(u)return u.lastIndex=c.lastIndex,t=rs(fs,u,l),c.lastIndex=u.lastIndex,t;var p=d.groups,f=bs&&c.sticky,h=rs(is,c),m=c.source,v=0,g=l;if(f&&(h=vs(h,"y",""),-1===ms(h,"g")&&(h+="g"),g=gs(l,c.lastIndex),c.lastIndex>0&&(!c.multiline||c.multiline&&"\n"!==hs(l,c.lastIndex-1))&&(m="(?: "+m+")",g=" "+g,v++),r=new RegExp("^(?:"+m+")",h)),Ss&&(r=new RegExp("^"+m+"$(?!\\s)",h)),ys&&(n=c.lastIndex),o=rs(ps,f?r:c,g),f?o?(o.input=gs(o.input,v),o[0]=gs(o[0],v),o.index=c.lastIndex,c.lastIndex+=o[0].length):c.lastIndex=0:ys&&o&&(c.lastIndex=c.global?o.index+o[0].length:n),Ss&&o&&o.length>1&&rs(us,o[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&p)for(o.groups=a=ss(null),i=0;i<p.length;i++)a[(s=p[i])[0]]=o[s[1]];return o});var ws=fs;Go({target:"RegExp",proto:!0,forced:/./.exec!==ws},{exec:ws});var Cs=I,Ts=Function.prototype,Rs=Ts.apply,ks=Ts.call,Ps="object"==typeof Reflect&&Reflect.apply||(Cs?ks.bind(Rs):function(){return ks.apply(Rs,arguments)}),Es=V,Ds=j,Is=function(e){if("Function"===Es(e))return Ds(e)},As=Is,Os=so,xs=ws,_s=D,js=Ge,Ms=nn,Ls=js("species"),Us=RegExp.prototype,Vs=j,Ns=Wt,Fs=za,Hs=B,Gs=Vs("".charAt),zs=Vs("".charCodeAt),Js=Vs("".slice),Ws=function(e){return function(t,r){var n,o,i=Fs(Hs(t)),a=Ns(r),s=i.length;return a<0||a>=s?e?"":void 0:(n=zs(i,a))<55296||n>56319||a+1===s||(o=zs(i,a+1))<56320||o>57343?e?Gs(i,a):n:e?Js(i,a,a+2):o-56320+(n-55296<<10)+65536}},qs={codeAt:Ws(!1),charAt:Ws(!0)},Bs=qs.charAt,$s=j,Ks=le,Ys=Math.floor,Qs=$s("".charAt),Xs=$s("".replace),Zs=$s("".slice),ec=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,tc=/\$([$&'`]|\d{1,2})/g,rc=tt,nc=qe,oc=g,ic=V,ac=ws,sc=TypeError,cc=Ps,dc=tt,lc=j,uc=function(e,t,r,n){var o=js(e),i=!_s((function(){var t={};return t[o]=function(){return 7},7!=""[e](t)})),a=i&&!_s((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[Ls]=function(){return r},r.flags="",r[o]=/./[o]),r.exec=function(){return t=!0,null},r[o](""),!t}));if(!i||!a||r){var s=As(/./[o]),c=t(o,""[e],(function(e,t,r,n,o){var a=As(e),c=t.exec;return c===xs||c===Us.exec?i&&!o?{done:!0,value:s(t,r,n)}:{done:!0,value:a(r,t,n)}:{done:!1}}));Os(String.prototype,e,c[0]),Os(Us,o,c[1])}n&&Ms(Us[o],"sham",!0)},pc=D,fc=qe,hc=g,mc=J,vc=Wt,gc=Xt,yc=za,bc=B,Sc=function(e,t,r){return t+(r?Bs(e,t).length:1)},wc=vt,Cc=function(e,t,r,n,o,i){var a=r+e.length,s=n.length,c=tc;return void 0!==o&&(o=Ks(o),c=ec),Xs(i,c,(function(i,c){var d;switch(Qs(c,0)){case"$":return"$";case"&":return e;case"`":return Zs(t,0,r);case"'":return Zs(t,a);case"<":d=o[Zs(c,1,-1)];break;default:var l=+c;if(0===l)return i;if(l>s){var u=Ys(l/10);return 0===u?i:u<=s?void 0===n[u-1]?Qs(c,1):n[u-1]+Qs(c,1):i}d=n[l-1]}return void 0===d?"":d}))},Tc=function(e,t){var r=e.exec;if(oc(r)){var n=rc(r,e,t);return null!==n&&nc(n),n}if("RegExp"===ic(e))return rc(ac,e,t);throw sc("RegExp#exec called on incompatible receiver")},Rc=Ge("replace"),kc=Math.max,Pc=Math.min,Ec=lc([].concat),Dc=lc([].push),Ic=lc("".indexOf),Ac=lc("".slice),Oc="$0"==="a".replace(/./,"$0"),xc=!!/./[Rc]&&""===/./[Rc]("a","$0");uc("replace",(function(e,t,r){var n=xc?"$":"$0";return[function(e,r){var n=bc(this),o=mc(e)?void 0:wc(e,Rc);return o?dc(o,e,n,r):dc(t,yc(n),e,r)},function(e,o){var i=fc(this),a=yc(e);if("string"==typeof o&&-1===Ic(o,n)&&-1===Ic(o,"$<")){var s=r(t,i,a,o);if(s.done)return s.value}var c=hc(o);c||(o=yc(o));var d=i.global;if(d){var l=i.unicode;i.lastIndex=0}for(var u=[];;){var p=Tc(i,a);if(null===p)break;if(Dc(u,p),!d)break;""===yc(p[0])&&(i.lastIndex=Sc(a,gc(i.lastIndex),l))}for(var f,h="",m=0,v=0;v<u.length;v++){for(var g=yc((p=u[v])[0]),y=kc(Pc(vc(p.index),a.length),0),b=[],S=1;S<p.length;S++)Dc(b,void 0===(f=p[S])?f:String(f));var w=p.groups;if(c){var C=Ec([g],b,y,a);void 0!==w&&Dc(C,w);var T=yc(cc(o,void 0,C))}else T=Cc(g,a,y,b,w,o);y>=m&&(h+=Ac(a,m,y)+T,m=y+g.length)}return h+Ac(a,m)}]}),!!pc((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!Oc||xc);let _c=!0,jc=!0;function Mc(e,t,r){const n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function Lc(e,t,r){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,o=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return o.apply(this,arguments);const i=e=>{const t=r(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,i),o.apply(this,[e,i])};const i=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t])return i.apply(this,arguments);if(!this._eventMap[t].has(r))return i.apply(this,arguments);const n=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,i.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function Uc(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(_c=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Vc(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(jc=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function Nc(){if("object"==typeof window){if(_c)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function Fc(e,t){jc&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Hc(e){return"[object Object]"===Object.prototype.toString.call(e)}function Gc(e){return Hc(e)?Object.keys(e).reduce((function(t,r){const n=Hc(e[r]),o=n?Gc(e[r]):e[r],i=n&&!Object.keys(o).length;return void 0===o||i?t:Object.assign(t,{[r]:o})}),{}):e}function zc(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((n=>{n.endsWith("Id")?zc(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach((t=>{zc(e,e.get(t),r)}))})))}function Jc(e,t,r){const n=r?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;const i=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&i.push(e)})),i.forEach((t=>{e.forEach((r=>{r.type===n&&r.trackId===t.id&&zc(e,r,o)}))})),o}const Wc=Nc;function qc(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const n=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((r=>{if("require"===r||"advanced"===r||"mediaSource"===r)return;const n="object"==typeof e[r]?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);const o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];let e={};"number"==typeof n.ideal?(e[o("min",r)]=n.ideal,t.optional.push(e),e={},e[o("max",r)]=n.ideal,t.optional.push(e)):(e[o("",r)]=n.ideal,t.optional.push(e))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",r)]=n.exact):["min","max"].forEach((e=>{void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,r)]=n[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},o=function(e,o){if(t.version>=61)return o(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"==typeof e.video){let i=e.video.facingMode;i=i&&("object"==typeof i?i:{ideal:i});const a=t.version<66;if(i&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===i.exact||"environment"===i.ideal?t=["back","rear"]:"user"!==i.exact&&"user"!==i.ideal||(t=["front"]),t)return r.mediaDevices.enumerateDevices().then((r=>{let a=(r=r.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!a&&r.length&&t.includes("back")&&(a=r[r.length-1]),a&&(e.video.deviceId=i.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=n(e.video),Wc("chrome: "+JSON.stringify(e)),o(e)}))}e.video=n(e.video)}return Wc("chrome: "+JSON.stringify(e)),o(e)},i=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(r.getUserMedia=function(e,t,n){o(e,(e=>{r.webkitGetUserMedia(e,t,(e=>{n&&n(i(e))}))}))}.bind(r),r.mediaDevices.getUserMedia){const e=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(t){return o(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(i(e))))))}}}function Bc(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function $c(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===r.track.id)):{track:r.track};const o=new Event("track");o.track=r.track,o.receiver=n,o.transceiver={receiver:n},o.streams=[t.stream],this.dispatchEvent(o)})),t.stream.getTracks().forEach((r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===r.id)):{track:r};const o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=[t.stream],this.dispatchEvent(o)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Lc(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function Kc(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){let o=r.apply(this,arguments);return o||(o=t(this,e),this._senders.push(o)),o};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function Yc(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,n]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const o=function(e){const t={};return e.result().forEach((e=>{const r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{r[t]=e.stat(t)})),t[r.id]=r})),t},i=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const n=function(e){r(i(o(e)))};return t.apply(this,[n,e])}return new Promise(((e,r)=>{t.apply(this,[function(t){e(i(o(t)))},r])})).then(r,n)}}function Qc(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>Jc(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),Lc(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>Jc(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,r,n;return this.getSenders().forEach((r=>{r.track===e&&(t?n=!0:t=r)})),this.getReceivers().forEach((t=>(t.track===e&&(r?n=!0:r=t),t.track===e))),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function Xc(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();r.apply(this,arguments);const n=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(n)};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const r=this._shimmedLocalStreams[t].indexOf(e);-1!==r&&this._shimmedLocalStreams[t].splice(r,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),o.apply(this,arguments)}}function Zc(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return Xc(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}n.apply(this,[t])};const o=e.RTCPeerConnection.prototype.removeStream;function i(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const n=e._reverseStreams[t],o=e._streams[n.id];r=r.replace(new RegExp(o.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:r})}function a(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const n=e._reverseStreams[t],o=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),o.id)})),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const o=this.getSenders().find((e=>e.track===t));if(o)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const i=this._streams[r.id];if(i)i.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const n=new e.MediaStream([t]);this._streams[r.id]=n,this._reverseStreams[n.id]=r,this.addStream(n)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?r.apply(this,[t=>{const r=i(this,t);e[0].apply(null,[r])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then((e=>i(this,e)))}};e.RTCPeerConnection.prototype[t]=n[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=a(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=c.get.apply(this);return""===e.type?e:i(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((r=>{this._streams[r].getTracks().find((t=>e.track===t))&&(t=this._streams[r])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function ed(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}))}function td(e,t){Lc(e,"negotiationneeded",(e=>{const r=e.target;if(!(t.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e}))}var rd=Object.freeze({__proto__:null,shimMediaStream:Bc,shimOnTrack:$c,shimGetSendersWithDtmf:Kc,shimGetStats:Yc,shimSenderReceiverGetStats:Qc,shimAddTrackRemoveTrackWithNative:Xc,shimAddTrackRemoveTrack:Zc,shimPeerConnection:ed,fixNegotiationNeeded:td,shimGetUserMedia:qc,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((t=>{const n=r.video&&r.video.width,o=r.video&&r.video.height,i=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:i||3}},n&&(r.video.mandatory.maxWidth=n),o&&(r.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function nd(e,t){const r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){Fc("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},t=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(r){return"object"==typeof r&&"object"==typeof r.audio&&(r=JSON.parse(JSON.stringify(r)),e(r.audio,"autoGainControl","mozAutoGainControl"),e(r.audio,"noiseSuppression","mozNoiseSuppression")),t(r)},n&&n.prototype.getSettings){const t=n.prototype.getSettings;n.prototype.getSettings=function(){const r=t.apply(this,arguments);return e(r,"mozAutoGainControl","autoGainControl"),e(r,"mozNoiseSuppression","noiseSuppression"),r}}if(n&&n.prototype.applyConstraints){const t=n.prototype.applyConstraints;n.prototype.applyConstraints=function(r){return"audio"===this.kind&&"object"==typeof r&&(r=JSON.parse(JSON.stringify(r)),e(r,"autoGainControl","mozAutoGainControl"),e(r,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[r])}}}}function od(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function id(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}));const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,o,i]=arguments;return n.apply(this,[e||null]).then((e=>{if(t.version<53&&!o)try{e.forEach((e=>{e.type=r[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,n)=>{e.set(n,Object.assign({},t,{type:r[t.type]||t.type}))}))}return e})).then(o,i)}}function ad(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function sd(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),Lc(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function cd(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){Fc("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function dd(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function ld(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const r=e.length>0;r&&e.forEach((e=>{if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const n=t.apply(this,arguments);if(r){const{sender:t}=n,r=t.getParameters();(!("encodings"in r)||1===r.encodings.length&&0===Object.keys(r.encodings[0]).length)&&(r.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(r).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return n})}function ud(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function pd(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function fd(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}var hd=Object.freeze({__proto__:null,shimOnTrack:od,shimPeerConnection:id,shimSenderGetStats:ad,shimReceiverGetStats:sd,shimRemoveStream:cd,shimRTCDataChannel:dd,shimAddTransceiver:ld,shimGetParameters:ud,shimCreateOffer:pd,shimCreateAnswer:fd,shimGetUserMedia:nd,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}});function md(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((r=>t.call(this,r,e))),e.getVideoTracks().forEach((r=>t.call(this,r,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...r){return r&&r.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const r=e.getTracks();this.getSenders().forEach((e=>{r.includes(e.track)&&this.removeTrack(e)}))})}}function vd(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}))}),t.apply(e,arguments)}}}function gd(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,o=t.setLocalDescription,i=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],o=r.apply(this,[n]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],o=n.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o};let s=function(e,t,r){const n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=s,s=function(e,t,r){const n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=s,s=function(e,t,r){const n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=s}function yd(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,r=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>r(bd(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))}function bd(e){return e&&void 0!==e.video?Object.assign({},e,{video:Gc(e.video)}):e}function Sd(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){const t=[];for(let r=0;r<e.iceServers.length;r++){let n=e.iceServers[r];!n.hasOwnProperty("urls")&&n.hasOwnProperty("url")?(Fc("RTCIceServer.url","RTCIceServer.urls"),n=JSON.parse(JSON.stringify(n)),n.urls=n.url,delete n.url,t.push(n)):t.push(e.iceServers[r])}e.iceServers=t}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function wd(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Cd(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const r=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Td(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Rd=Object.freeze({__proto__:null,shimLocalStreamsAPI:md,shimRemoteStreamsAPI:vd,shimCallbacksAPI:gd,shimGetUserMedia:yd,shimConstraints:bd,shimRTCIceServerUrls:Sd,shimTrackEventTransceiver:wd,shimCreateOfferLegacy:Cd,shimAudioContext:Td}),kd={};!function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const r=t.splitSections(e);return r&&r[0]},t.getMediaSections=function(e){const r=t.splitSections(e);return r.shift(),r},t.matchPrefix=function(e,r){return t.splitLines(e).filter((e=>0===e.indexOf(r)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const r={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":r.relatedAddress=t[e+1];break;case"rport":r.relatedPort=parseInt(t[e+1],10);break;case"tcptype":r.tcpType=t[e+1];break;case"ufrag":r.ufrag=t[e+1],r.usernameFragment=t[e+1];break;default:void 0===r[t[e]]&&(r[t[e]]=t[e+1])}return r},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){let t=e.substr(9).split(" ");const r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){const t={};let r;const n=e.substr(e.indexOf(" ")+1).split(";");for(let e=0;e<n.length;e++)r=n[e].trim().split("="),t[r[0].trim()]=r[1];return t},t.writeFmtp=function(e){let t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const n=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},t.parseSsrcGroup=function(e){const t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const r=t.matchPrefix(e,"a=mid:")[0];if(r)return r.substr(6)},t.parseFingerprint=function(e){const t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,r){return{role:"auto",fingerprints:t.matchPrefix(e+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},t.parseCryptoLine=function(e){const t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,r){return t.matchPrefix(e+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,r){const n=t.matchPrefix(e+r,"a=ice-ufrag:")[0],o=t.matchPrefix(e+r,"a=ice-pwd:")[0];return n&&o?{usernameFragment:n.substr(12),password:o.substr(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(e)[0].split(" ");for(let o=3;o<n.length;o++){const i=n[o],a=t.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(a){const n=t.parseRtpMap(a),o=t.matchPrefix(e,"a=fmtp:"+i+" ");switch(n.parameters=o.length?t.parseFmtp(o[0]):{},n.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(t.parseRtcpFb),r.codecs.push(n),n.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(n.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((e=>{r.headerExtensions.push(t.parseExtmap(e))})),r},t.writeRtpDescription=function(e,r){let n="";n+="m="+e+" ",n+=r.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=r.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r.codecs.forEach((e=>{n+=t.writeRtpMap(e),n+=t.writeFmtp(e),n+=t.writeRtcpFb(e)}));let o=0;return r.codecs.forEach((e=>{e.maxptime>o&&(o=e.maxptime)})),o>0&&(n+="a=maxptime:"+o+"\r\n"),r.headerExtensions&&r.headerExtensions.forEach((e=>{n+=t.writeExtmap(e)})),n},t.parseRtpEncodingParameters=function(e){const r=[],n=t.parseRtpParameters(e),o=-1!==n.fecMechanisms.indexOf("RED"),i=-1!==n.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),s=a.length>0&&a[0].ssrc;let c;const d=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substr(17).split(" ").map((e=>parseInt(e,10)))));d.length>0&&d[0].length>1&&d[0][0]===s&&(c=d[0][1]),n.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(t.rtx={ssrc:c}),r.push(t),o&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:i?"red+ulpfec":"red"},r.push(t))}})),0===r.length&&s&&r.push({ssrc:s});let l=t.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,r.forEach((e=>{e.maxBitrate=l}))),r},t.parseRtcpParameters=function(e){const r={},n=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);const o=t.matchPrefix(e,"a=rtcp-rsize");r.reducedSize=o.length>0,r.compound=0===o.length;const i=t.matchPrefix(e,"a=rtcp-mux");return r.mux=i.length>0,r},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let r;const n=t.matchPrefix(e,"a=msid:");if(1===n.length)return r=n[0].substr(7).split(" "),{stream:r[0],track:r[1]};const o=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return o.length>0?(r=o[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(e){const r=t.parseMLine(e),n=t.matchPrefix(e,"a=max-message-size:");let o;n.length>0&&(o=parseInt(n[0].substr(19),10)),isNaN(o)&&(o=65536);const i=t.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substr(12),10),protocol:r.fmt,maxMessageSize:o};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substr(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:o}}},t.writeSctpDescription=function(e,t){let r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,r,n){let o;const i=void 0!==r?r:2;o=e||t.generateSessionId();return"v=0\r\no="+(n||"thisisadapterortc")+" "+o+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,r){const n=t.splitLines(e);for(let e=0;e<n.length;e++)switch(n[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[e].substr(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const r=t.splitLines(e)[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(e){const r=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const r=t.splitLines(e);for(let e=0;e<r.length;e++)if(r[e].length<2||"="!==r[e].charAt(1))return!1;return!0},e.exports=t}({get exports(){return kd},set exports(e){kd=e}});var Pd=kd,Ed=t({__proto__:null,default:Pd},[kd]);function Dd(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const r=new t(e),n=Pd.parseCandidate(e.candidate),o=Object.assign(r,n);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,Lc(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function Id(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Lc(e,"icecandidate",(e=>{if(e.candidate){const t=Pd.parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function Ad(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const r=function(e){if(!e||!e.sdp)return!1;const t=Pd.splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Pd.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},n=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const r=parseInt(t[1],10);return r!=r?-1:r},o=function(e){let r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},i=function(e,r){let n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);const o=Pd.matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?n=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const e=n(arguments[0]),t=o(e),r=i(arguments[0],e);let a;a=0===t&&0===r?Number.POSITIVE_INFINITY:0===t||0===r?Math.max(t,r):Math.min(t,r);const s={};Object.defineProperty(s,"maxMessageSize",{get:()=>a}),this._sctp=s}return a.apply(this,arguments)}}function Od(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const r=e.send;e.send=function(){const n=arguments[0],o=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&o>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=r.apply(this,arguments);return t(e,this),e},Lc(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function xd(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}function _d(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const r=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return r.apply(this,arguments)}}function jd(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function Md(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return r.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return r.apply(this,[e]);const t="offer"===e.type?this.createOffer:this.createAnswer;return t.apply(this).then((e=>r.apply(this,[e])))})}var Ld=Object.freeze({__proto__:null,shimRTCIceCandidate:Dd,shimRTCIceCandidateRelayProtocol:Id,shimMaxMessageSize:Ad,shimSendThrowTypeError:Od,shimConnectionState:xd,removeExtmapAllowMixed:_d,shimAddIceCandidateNullOrEmpty:jd,shimParameterlessSetLocalDescription:Md});const Ud=function({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=Nc,n=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:r}=e;if(r.mozGetUserMedia)t.browser="firefox",t.version=Mc(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Mc(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Mc(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(e),o={browserDetails:n,commonShim:Ld,extractVersion:Mc,disableLog:Uc,disableWarnings:Vc,sdp:Ed};switch(n.browser){case"chrome":if(!rd||!ed||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),o;if(null===n.version)return r("Chrome shim can not determine version, not shimming."),o;r("adapter.js shimming chrome."),o.browserShim=rd,jd(e,n),Md(e),qc(e,n),Bc(e),ed(e,n),$c(e),Zc(e,n),Kc(e),Yc(e),Qc(e),td(e,n),Dd(e),Id(e),xd(e),Ad(e,n),Od(e),_d(e,n);break;case"firefox":if(!hd||!id||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),o;r("adapter.js shimming firefox."),o.browserShim=hd,jd(e,n),Md(e),nd(e,n),id(e,n),od(e),cd(e),ad(e),sd(e),dd(e),ld(e),ud(e),pd(e),fd(e),Dd(e),xd(e),Ad(e,n),Od(e);break;case"safari":if(!Rd||!t.shimSafari)return r("Safari shim is not included in this adapter release."),o;r("adapter.js shimming safari."),o.browserShim=Rd,jd(e,n),Md(e),Sd(e),Cd(e),gd(e),md(e),vd(e),wd(e),yd(e),Td(e),Dd(e),Id(e),Ad(e,n),Od(e),_d(e,n);break;default:r("Unsupported browser!")}return o}({window:"undefined"==typeof window?void 0:window});var Vd=qs.charAt,Nd=za,Fd=yn,Hd=Ji,Gd=Wi,zd="String Iterator",Jd=Fd.set,Wd=Fd.getterFor(zd);Hd(String,"String",(function(e){Jd(this,{type:zd,string:Nd(e),index:0})}),(function(){var e,t=Wd(this),r=t.string,n=t.index;return n>=r.length?Gd(void 0,!0):(e=Vd(r,n),t.index+=e.length,Gd(e,!1))}));var qd=D,Bd=Ge("iterator"),$d=!qd((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,r="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),r+=n+e})),!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[Bd]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==r||"x"!==new URL("http://x",void 0).host})),Kd=ft,Yd=I,Qd=Is(Is.bind),Xd=function(e,t){return Kd(e),void 0===t?e:Yd?Qd(e,t):function(){return e.apply(t,arguments)}},Zd=_n,el=Ye,tl=rt,rl=TypeError,nl=function(e,t){if(tl(t,e))return e;throw rl("Incorrect invocation")},ol=$e,il=j,al=tt,sl=D,cl=vr,dl=po,ll=Sn,ul=le,pl=z,fl=Object.assign,hl=Object.defineProperty,ml=il([].concat),vl=!fl||sl((function(){if(ol&&1!==fl({b:1},fl(hl({},"a",{enumerable:!0,get:function(){hl(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach((function(e){t[e]=e})),7!=fl({},e)[r]||cl(fl({},t)).join("")!=n}))?function(e,t){for(var r=ul(e),n=arguments.length,o=1,i=dl.f,a=ll.f;n>o;)for(var s,c=pl(arguments[o++]),d=i?ml(cl(c),i(c)):cl(c),l=d.length,u=0;l>u;)s=d[u++],ol&&!al(a,c,s)||(r[s]=c[s]);return r}:fl,gl=tt,yl=qe,bl=vt,Sl=qe,wl=function(e,t,r){var n,o;yl(e);try{if(!(n=bl(e,"return"))){if("throw"===t)throw r;return r}n=gl(n,e)}catch(e){o=!0,n=e}if("throw"===t)throw r;if(o)throw n;return yl(n),r},Cl=Yr,Tl=Ge("iterator"),Rl=Array.prototype,kl=j,Pl=D,El=g,Dl=Fa,Il=Jn,Al=function(){},Ol=[],xl=Ce("Reflect","construct"),_l=/^\s*(?:class|function)\b/,jl=kl(_l.exec),Ml=!_l.exec(Al),Ll=function(e){if(!El(e))return!1;try{return xl(Al,Ol,e),!0}catch(e){return!1}},Ul=function(e){if(!El(e))return!1;switch(Dl(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Ml||!!jl(_l,Il(e))}catch(e){return!0}};Ul.sham=!0;var Vl=!xl||Pl((function(){var e;return Ll(Ll.call)||!Ll(Object)||!Ll((function(){e=!0}))||e}))?Ul:Ll,Nl=At,Fl=Ye,Hl=en,Gl=function(e,t,r){var n=Nl(t);n in e?Fl.f(e,n,Hl(0,r)):e[n]=r},zl=Fa,Jl=vt,Wl=J,ql=Yr,Bl=Ge("iterator"),$l=function(e){if(!Wl(e))return Jl(e,Bl)||Jl(e,"@@iterator")||ql[zl(e)]},Kl=tt,Yl=ft,Ql=qe,Xl=dt,Zl=$l,eu=TypeError,tu=function(e,t){var r=arguments.length<2?Zl(e):t;if(Yl(r))return Ql(Kl(r,e));throw eu(Xl(e)+" is not iterable")},ru=Xd,nu=tt,ou=le,iu=function(e,t,r,n){try{return n?t(Sl(r)[0],r[1]):t(r)}catch(t){wl(e,"throw",t)}},au=function(e){return void 0!==e&&(Cl.Array===e||Rl[Tl]===e)},su=Vl,cu=er,du=Gl,lu=tu,uu=$l,pu=Array,fu=Kt,hu=er,mu=Gl,vu=Array,gu=Math.max,yu=function(e,t,r){for(var n=hu(e),o=fu(t,n),i=fu(void 0===r?n:r,n),a=vu(gu(i-o,0)),s=0;o<i;o++,s++)mu(a,s,e[o]);return a.length=s,a},bu=j,Su=2147483647,wu=/[^\0-\u007E]/,Cu=/[.\u3002\uFF0E\uFF61]/g,Tu="Overflow: input needs wider integers to process",Ru=RangeError,ku=bu(Cu.exec),Pu=Math.floor,Eu=String.fromCharCode,Du=bu("".charCodeAt),Iu=bu([].join),Au=bu([].push),Ou=bu("".replace),xu=bu("".split),_u=bu("".toLowerCase),ju=function(e){return e+22+75*(e<26)},Mu=function(e,t,r){var n=0;for(e=r?Pu(e/700):e>>1,e+=Pu(e/t);e>455;)e=Pu(e/35),n+=36;return Pu(n+36*e/(e+38))},Lu=function(e){var t=[];e=function(e){for(var t=[],r=0,n=e.length;r<n;){var o=Du(e,r++);if(o>=55296&&o<=56319&&r<n){var i=Du(e,r++);56320==(64512&i)?Au(t,((1023&o)<<10)+(1023&i)+65536):(Au(t,o),r--)}else Au(t,o)}return t}(e);var r,n,o=e.length,i=128,a=0,s=72;for(r=0;r<e.length;r++)(n=e[r])<128&&Au(t,Eu(n));var c=t.length,d=c;for(c&&Au(t,"-");d<o;){var l=Su;for(r=0;r<e.length;r++)(n=e[r])>=i&&n<l&&(l=n);var u=d+1;if(l-i>Pu((Su-a)/u))throw Ru(Tu);for(a+=(l-i)*u,i=l,r=0;r<e.length;r++){if((n=e[r])<i&&++a>Su)throw Ru(Tu);if(n==i){for(var p=a,f=36;;){var h=f<=s?1:f>=s+26?26:f-s;if(p<h)break;var m=p-h,v=36-h;Au(t,Eu(ju(h+m%v))),p=Pu(m/v),f+=36}Au(t,Eu(ju(p))),s=Mu(a,u,d==c),a=0,d++}}a++,i++}return Iu(t,"")},Uu=TypeError,Vu=function(e,t){if(e<t)throw Uu("Not enough arguments");return e},Nu=so,Fu=yu,Hu=Math.floor,Gu=function(e,t){var r=e.length,n=Hu(r/2);return r<8?zu(e,t):Ju(e,Gu(Fu(e,0,n),t),Gu(Fu(e,n),t),t)},zu=function(e,t){for(var r,n,o=e.length,i=1;i<o;){for(n=i,r=e[i];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==i++&&(e[n]=r)}return e},Ju=function(e,t,r,n){for(var o=t.length,i=r.length,a=0,s=0;a<o||s<i;)e[a+s]=a<o&&s<i?n(t[a],r[s])<=0?t[a++]:r[s++]:a<o?t[a++]:r[s++];return e},Wu=Go,qu=f,Bu=tt,$u=j,Ku=$e,Yu=$d,Qu=so,Xu=function(e,t,r){for(var n in t)Nu(e,n,t[n],r);return e},Zu=li,ep=gi,tp=yn,rp=nl,np=g,op=fe,ip=Xd,ap=Fa,sp=qe,cp=S,dp=za,lp=Hr,up=en,pp=tu,fp=$l,hp=Vu,mp=Gu,vp=Ge("iterator"),gp="URLSearchParams",yp=gp+"Iterator",bp=tp.set,Sp=tp.getterFor(gp),wp=tp.getterFor(yp),Cp=Object.getOwnPropertyDescriptor,Tp=function(e){if(!Ku)return qu[e];var t=Cp(qu,e);return t&&t.value},Rp=Tp("fetch"),kp=Tp("Request"),Pp=Tp("Headers"),Ep=kp&&kp.prototype,Dp=Pp&&Pp.prototype,Ip=qu.RegExp,Ap=qu.TypeError,Op=qu.decodeURIComponent,xp=qu.encodeURIComponent,_p=$u("".charAt),jp=$u([].join),Mp=$u([].push),Lp=$u("".replace),Up=$u([].shift),Vp=$u([].splice),Np=$u("".split),Fp=$u("".slice),Hp=/\+/g,Gp=Array(4),zp=function(e){return Gp[e-1]||(Gp[e-1]=Ip("((?:%[\\da-f]{2}){"+e+"})","gi"))},Jp=function(e){try{return Op(e)}catch(t){return e}},Wp=function(e){var t=Lp(e,Hp," "),r=4;try{return Op(t)}catch(e){for(;r;)t=Lp(t,zp(r--),Jp);return t}},qp=/[!'()~]|%20/g,Bp={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},$p=function(e){return Bp[e]},Kp=function(e){return Lp(xp(e),qp,$p)},Yp=ep((function(e,t){bp(this,{type:yp,iterator:pp(Sp(e).entries),kind:t})}),"Iterator",(function(){var e=wp(this),t=e.kind,r=e.iterator.next(),n=r.value;return r.done||(r.value="keys"===t?n.key:"values"===t?n.value:[n.key,n.value]),r}),!0),Qp=function(e){this.entries=[],this.url=null,void 0!==e&&(cp(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===_p(e,0)?Fp(e,1):e:dp(e)))};Qp.prototype={type:gp,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,r,n,o,i,a,s,c=fp(e);if(c)for(r=(t=pp(e,c)).next;!(n=Bu(r,t)).done;){if(i=(o=pp(sp(n.value))).next,(a=Bu(i,o)).done||(s=Bu(i,o)).done||!Bu(i,o).done)throw Ap("Expected sequence with length 2");Mp(this.entries,{key:dp(a.value),value:dp(s.value)})}else for(var d in e)op(e,d)&&Mp(this.entries,{key:d,value:dp(e[d])})},parseQuery:function(e){if(e)for(var t,r,n=Np(e,"&"),o=0;o<n.length;)(t=n[o++]).length&&(r=Np(t,"="),Mp(this.entries,{key:Wp(Up(r)),value:Wp(jp(r,"="))}))},serialize:function(){for(var e,t=this.entries,r=[],n=0;n<t.length;)e=t[n++],Mp(r,Kp(e.key)+"="+Kp(e.value));return jp(r,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var Xp=function(){rp(this,Zp);var e=arguments.length>0?arguments[0]:void 0;bp(this,new Qp(e))},Zp=Xp.prototype;if(Xu(Zp,{append:function(e,t){hp(arguments.length,2);var r=Sp(this);Mp(r.entries,{key:dp(e),value:dp(t)}),r.updateURL()},delete:function(e){hp(arguments.length,1);for(var t=Sp(this),r=t.entries,n=dp(e),o=0;o<r.length;)r[o].key===n?Vp(r,o,1):o++;t.updateURL()},get:function(e){hp(arguments.length,1);for(var t=Sp(this).entries,r=dp(e),n=0;n<t.length;n++)if(t[n].key===r)return t[n].value;return null},getAll:function(e){hp(arguments.length,1);for(var t=Sp(this).entries,r=dp(e),n=[],o=0;o<t.length;o++)t[o].key===r&&Mp(n,t[o].value);return n},has:function(e){hp(arguments.length,1);for(var t=Sp(this).entries,r=dp(e),n=0;n<t.length;)if(t[n++].key===r)return!0;return!1},set:function(e,t){hp(arguments.length,1);for(var r,n=Sp(this),o=n.entries,i=!1,a=dp(e),s=dp(t),c=0;c<o.length;c++)(r=o[c]).key===a&&(i?Vp(o,c--,1):(i=!0,r.value=s));i||Mp(o,{key:a,value:s}),n.updateURL()},sort:function(){var e=Sp(this);mp(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,r=Sp(this).entries,n=ip(e,arguments.length>1?arguments[1]:void 0),o=0;o<r.length;)n((t=r[o++]).value,t.key,this)},keys:function(){return new Yp(this,"keys")},values:function(){return new Yp(this,"values")},entries:function(){return new Yp(this,"entries")}},{enumerable:!0}),Qu(Zp,vp,Zp.entries,{name:"entries"}),Qu(Zp,"toString",(function(){return Sp(this).serialize()}),{enumerable:!0}),Zu(Xp,gp),Wu({global:!0,constructor:!0,forced:!Yu},{URLSearchParams:Xp}),!Yu&&np(Pp)){var ef=$u(Dp.has),tf=$u(Dp.set),rf=function(e){if(cp(e)){var t,r=e.body;if(ap(r)===gp)return t=e.headers?new Pp(e.headers):new Pp,ef(t,"content-type")||tf(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),lp(e,{body:up(0,dp(r)),headers:up(0,t)})}return e};if(np(Rp)&&Wu({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return Rp(e,arguments.length>1?rf(arguments[1]):{})}}),np(kp)){var nf=function(e){return rp(this,Ep),new kp(e,arguments.length>1?rf(arguments[1]):{})};Ep.constructor=nf,nf.prototype=Ep,Wu({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:nf})}}var of,af=Go,sf=$e,cf=$d,df=f,lf=Xd,uf=j,pf=so,ff=function(e,t,r){return r.get&&Zd(r.get,t,{getter:!0}),r.set&&Zd(r.set,t,{setter:!0}),el.f(e,t,r)},hf=nl,mf=fe,vf=vl,gf=function(e){var t=ou(e),r=su(this),n=arguments.length,o=n>1?arguments[1]:void 0,i=void 0!==o;i&&(o=ru(o,n>2?arguments[2]:void 0));var a,s,c,d,l,u,p=uu(t),f=0;if(!p||this===pu&&au(p))for(a=cu(t),s=r?new this(a):pu(a);a>f;f++)u=i?o(t[f],f):t[f],du(s,f,u);else for(l=(d=lu(t,p)).next,s=r?new this:[];!(c=nu(l,d)).done;f++)u=i?iu(d,o,[c.value,f],!0):c.value,du(s,f,u);return s.length=f,s},yf=yu,bf=qs.codeAt,Sf=function(e){var t,r,n=[],o=xu(Ou(_u(e),Cu,"."),".");for(t=0;t<o.length;t++)r=o[t],Au(n,ku(wu,r)?"xn--"+Lu(r):r);return Iu(n,".")},wf=za,Cf=li,Tf=Vu,Rf={URLSearchParams:Xp,getState:Sp},kf=yn,Pf=kf.set,Ef=kf.getterFor("URL"),Df=Rf.URLSearchParams,If=Rf.getState,Af=df.URL,Of=df.TypeError,xf=df.parseInt,_f=Math.floor,jf=Math.pow,Mf=uf("".charAt),Lf=uf(/./.exec),Uf=uf([].join),Vf=uf(1..toString),Nf=uf([].pop),Ff=uf([].push),Hf=uf("".replace),Gf=uf([].shift),zf=uf("".split),Jf=uf("".slice),Wf=uf("".toLowerCase),qf=uf([].unshift),Bf="Invalid scheme",$f="Invalid host",Kf="Invalid port",Yf=/[a-z]/i,Qf=/[\d+-.a-z]/i,Xf=/\d/,Zf=/^0x/i,eh=/^[0-7]+$/,th=/^\d+$/,rh=/^[\da-f]+$/i,nh=/[\0\t\n\r #%/:<>?@[\\\]^|]/,oh=/[\0\t\n\r #/:<>?@[\\\]^|]/,ih=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,ah=/[\t\n\r]/g,sh=function(e){var t,r,n,o;if("number"==typeof e){for(t=[],r=0;r<4;r++)qf(t,e%256),e=_f(e/256);return Uf(t,".")}if("object"==typeof e){for(t="",n=function(e){for(var t=null,r=1,n=null,o=0,i=0;i<8;i++)0!==e[i]?(o>r&&(t=n,r=o),n=null,o=0):(null===n&&(n=i),++o);return o>r&&(t=n,r=o),t}(e),r=0;r<8;r++)o&&0===e[r]||(o&&(o=!1),n===r?(t+=r?":":"::",o=!0):(t+=Vf(e[r],16),r<7&&(t+=":")));return"["+t+"]"}return e},ch={},dh=vf({},ch,{" ":1,'"':1,"<":1,">":1,"`":1}),lh=vf({},dh,{"#":1,"?":1,"{":1,"}":1}),uh=vf({},lh,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),ph=function(e,t){var r=bf(e,0);return r>32&&r<127&&!mf(t,e)?e:encodeURIComponent(e)},fh={ftp:21,file:null,http:80,https:443,ws:80,wss:443},hh=function(e,t){var r;return 2==e.length&&Lf(Yf,Mf(e,0))&&(":"==(r=Mf(e,1))||!t&&"|"==r)},mh=function(e){var t;return e.length>1&&hh(Jf(e,0,2))&&(2==e.length||"/"===(t=Mf(e,2))||"\\"===t||"?"===t||"#"===t)},vh=function(e){return"."===e||"%2e"===Wf(e)},gh={},yh={},bh={},Sh={},wh={},Ch={},Th={},Rh={},kh={},Ph={},Eh={},Dh={},Ih={},Ah={},Oh={},xh={},_h={},jh={},Mh={},Lh={},Uh={},Vh=function(e,t,r){var n,o,i,a=wf(e);if(t){if(o=this.parse(a))throw Of(o);this.searchParams=null}else{if(void 0!==r&&(n=new Vh(r,!0)),o=this.parse(a,null,n))throw Of(o);(i=If(new Df)).bindURL(this),this.searchParams=i}};Vh.prototype={type:"URL",parse:function(e,t,r){var n,o,i,a,s,c=this,d=t||gh,l=0,u="",p=!1,f=!1,h=!1;for(e=wf(e),t||(c.scheme="",c.username="",c.password="",c.host=null,c.port=null,c.path=[],c.query=null,c.fragment=null,c.cannotBeABaseURL=!1,e=Hf(e,ih,"")),e=Hf(e,ah,""),n=gf(e);l<=n.length;){switch(o=n[l],d){case gh:if(!o||!Lf(Yf,o)){if(t)return Bf;d=bh;continue}u+=Wf(o),d=yh;break;case yh:if(o&&(Lf(Qf,o)||"+"==o||"-"==o||"."==o))u+=Wf(o);else{if(":"!=o){if(t)return Bf;u="",d=bh,l=0;continue}if(t&&(c.isSpecial()!=mf(fh,u)||"file"==u&&(c.includesCredentials()||null!==c.port)||"file"==c.scheme&&!c.host))return;if(c.scheme=u,t)return void(c.isSpecial()&&fh[c.scheme]==c.port&&(c.port=null));u="","file"==c.scheme?d=Ah:c.isSpecial()&&r&&r.scheme==c.scheme?d=Sh:c.isSpecial()?d=Rh:"/"==n[l+1]?(d=wh,l++):(c.cannotBeABaseURL=!0,Ff(c.path,""),d=Mh)}break;case bh:if(!r||r.cannotBeABaseURL&&"#"!=o)return Bf;if(r.cannotBeABaseURL&&"#"==o){c.scheme=r.scheme,c.path=yf(r.path),c.query=r.query,c.fragment="",c.cannotBeABaseURL=!0,d=Uh;break}d="file"==r.scheme?Ah:Ch;continue;case Sh:if("/"!=o||"/"!=n[l+1]){d=Ch;continue}d=kh,l++;break;case wh:if("/"==o){d=Ph;break}d=jh;continue;case Ch:if(c.scheme=r.scheme,o==of)c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=yf(r.path),c.query=r.query;else if("/"==o||"\\"==o&&c.isSpecial())d=Th;else if("?"==o)c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=yf(r.path),c.query="",d=Lh;else{if("#"!=o){c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=yf(r.path),c.path.length--,d=jh;continue}c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,c.path=yf(r.path),c.query=r.query,c.fragment="",d=Uh}break;case Th:if(!c.isSpecial()||"/"!=o&&"\\"!=o){if("/"!=o){c.username=r.username,c.password=r.password,c.host=r.host,c.port=r.port,d=jh;continue}d=Ph}else d=kh;break;case Rh:if(d=kh,"/"!=o||"/"!=Mf(u,l+1))continue;l++;break;case kh:if("/"!=o&&"\\"!=o){d=Ph;continue}break;case Ph:if("@"==o){p&&(u="%40"+u),p=!0,i=gf(u);for(var m=0;m<i.length;m++){var v=i[m];if(":"!=v||h){var g=ph(v,uh);h?c.password+=g:c.username+=g}else h=!0}u=""}else if(o==of||"/"==o||"?"==o||"#"==o||"\\"==o&&c.isSpecial()){if(p&&""==u)return"Invalid authority";l-=gf(u).length+1,u="",d=Eh}else u+=o;break;case Eh:case Dh:if(t&&"file"==c.scheme){d=xh;continue}if(":"!=o||f){if(o==of||"/"==o||"?"==o||"#"==o||"\\"==o&&c.isSpecial()){if(c.isSpecial()&&""==u)return $f;if(t&&""==u&&(c.includesCredentials()||null!==c.port))return;if(a=c.parseHost(u))return a;if(u="",d=_h,t)return;continue}"["==o?f=!0:"]"==o&&(f=!1),u+=o}else{if(""==u)return $f;if(a=c.parseHost(u))return a;if(u="",d=Ih,t==Dh)return}break;case Ih:if(!Lf(Xf,o)){if(o==of||"/"==o||"?"==o||"#"==o||"\\"==o&&c.isSpecial()||t){if(""!=u){var y=xf(u,10);if(y>65535)return Kf;c.port=c.isSpecial()&&y===fh[c.scheme]?null:y,u=""}if(t)return;d=_h;continue}return Kf}u+=o;break;case Ah:if(c.scheme="file","/"==o||"\\"==o)d=Oh;else{if(!r||"file"!=r.scheme){d=jh;continue}if(o==of)c.host=r.host,c.path=yf(r.path),c.query=r.query;else if("?"==o)c.host=r.host,c.path=yf(r.path),c.query="",d=Lh;else{if("#"!=o){mh(Uf(yf(n,l),""))||(c.host=r.host,c.path=yf(r.path),c.shortenPath()),d=jh;continue}c.host=r.host,c.path=yf(r.path),c.query=r.query,c.fragment="",d=Uh}}break;case Oh:if("/"==o||"\\"==o){d=xh;break}r&&"file"==r.scheme&&!mh(Uf(yf(n,l),""))&&(hh(r.path[0],!0)?Ff(c.path,r.path[0]):c.host=r.host),d=jh;continue;case xh:if(o==of||"/"==o||"\\"==o||"?"==o||"#"==o){if(!t&&hh(u))d=jh;else if(""==u){if(c.host="",t)return;d=_h}else{if(a=c.parseHost(u))return a;if("localhost"==c.host&&(c.host=""),t)return;u="",d=_h}continue}u+=o;break;case _h:if(c.isSpecial()){if(d=jh,"/"!=o&&"\\"!=o)continue}else if(t||"?"!=o)if(t||"#"!=o){if(o!=of&&(d=jh,"/"!=o))continue}else c.fragment="",d=Uh;else c.query="",d=Lh;break;case jh:if(o==of||"/"==o||"\\"==o&&c.isSpecial()||!t&&("?"==o||"#"==o)){if(".."===(s=Wf(s=u))||"%2e."===s||".%2e"===s||"%2e%2e"===s?(c.shortenPath(),"/"==o||"\\"==o&&c.isSpecial()||Ff(c.path,"")):vh(u)?"/"==o||"\\"==o&&c.isSpecial()||Ff(c.path,""):("file"==c.scheme&&!c.path.length&&hh(u)&&(c.host&&(c.host=""),u=Mf(u,0)+":"),Ff(c.path,u)),u="","file"==c.scheme&&(o==of||"?"==o||"#"==o))for(;c.path.length>1&&""===c.path[0];)Gf(c.path);"?"==o?(c.query="",d=Lh):"#"==o&&(c.fragment="",d=Uh)}else u+=ph(o,lh);break;case Mh:"?"==o?(c.query="",d=Lh):"#"==o?(c.fragment="",d=Uh):o!=of&&(c.path[0]+=ph(o,ch));break;case Lh:t||"#"!=o?o!=of&&("'"==o&&c.isSpecial()?c.query+="%27":c.query+="#"==o?"%23":ph(o,ch)):(c.fragment="",d=Uh);break;case Uh:o!=of&&(c.fragment+=ph(o,dh))}l++}},parseHost:function(e){var t,r,n;if("["==Mf(e,0)){if("]"!=Mf(e,e.length-1))return $f;if(t=function(e){var t,r,n,o,i,a,s,c=[0,0,0,0,0,0,0,0],d=0,l=null,u=0,p=function(){return Mf(e,u)};if(":"==p()){if(":"!=Mf(e,1))return;u+=2,l=++d}for(;p();){if(8==d)return;if(":"!=p()){for(t=r=0;r<4&&Lf(rh,p());)t=16*t+xf(p(),16),u++,r++;if("."==p()){if(0==r)return;if(u-=r,d>6)return;for(n=0;p();){if(o=null,n>0){if(!("."==p()&&n<4))return;u++}if(!Lf(Xf,p()))return;for(;Lf(Xf,p());){if(i=xf(p(),10),null===o)o=i;else{if(0==o)return;o=10*o+i}if(o>255)return;u++}c[d]=256*c[d]+o,2!=++n&&4!=n||d++}if(4!=n)return;break}if(":"==p()){if(u++,!p())return}else if(p())return;c[d++]=t}else{if(null!==l)return;u++,l=++d}}if(null!==l)for(a=d-l,d=7;0!=d&&a>0;)s=c[d],c[d--]=c[l+a-1],c[l+--a]=s;else if(8!=d)return;return c}(Jf(e,1,-1)),!t)return $f;this.host=t}else if(this.isSpecial()){if(e=Sf(e),Lf(nh,e))return $f;if(t=function(e){var t,r,n,o,i,a,s,c=zf(e,".");if(c.length&&""==c[c.length-1]&&c.length--,(t=c.length)>4)return e;for(r=[],n=0;n<t;n++){if(""==(o=c[n]))return e;if(i=10,o.length>1&&"0"==Mf(o,0)&&(i=Lf(Zf,o)?16:8,o=Jf(o,8==i?1:2)),""===o)a=0;else{if(!Lf(10==i?th:8==i?eh:rh,o))return e;a=xf(o,i)}Ff(r,a)}for(n=0;n<t;n++)if(a=r[n],n==t-1){if(a>=jf(256,5-t))return null}else if(a>255)return null;for(s=Nf(r),n=0;n<r.length;n++)s+=r[n]*jf(256,3-n);return s}(e),null===t)return $f;this.host=t}else{if(Lf(oh,e))return $f;for(t="",r=gf(e),n=0;n<r.length;n++)t+=ph(r[n],ch);this.host=t}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return mf(fh,this.scheme)},shortenPath:function(){var e=this.path,t=e.length;!t||"file"==this.scheme&&1==t&&hh(e[0],!0)||e.length--},serialize:function(){var e=this,t=e.scheme,r=e.username,n=e.password,o=e.host,i=e.port,a=e.path,s=e.query,c=e.fragment,d=t+":";return null!==o?(d+="//",e.includesCredentials()&&(d+=r+(n?":"+n:"")+"@"),d+=sh(o),null!==i&&(d+=":"+i)):"file"==t&&(d+="//"),d+=e.cannotBeABaseURL?a[0]:a.length?"/"+Uf(a,"/"):"",null!==s&&(d+="?"+s),null!==c&&(d+="#"+c),d},setHref:function(e){var t=this.parse(e);if(t)throw Of(t);this.searchParams.update()},getOrigin:function(){var e=this.scheme,t=this.port;if("blob"==e)try{return new Nh(e.path[0]).origin}catch(e){return"null"}return"file"!=e&&this.isSpecial()?e+"://"+sh(this.host)+(null!==t?":"+t:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(wf(e)+":",gh)},getUsername:function(){return this.username},setUsername:function(e){var t=gf(wf(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var r=0;r<t.length;r++)this.username+=ph(t[r],uh)}},getPassword:function(){return this.password},setPassword:function(e){var t=gf(wf(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var r=0;r<t.length;r++)this.password+=ph(t[r],uh)}},getHost:function(){var e=this.host,t=this.port;return null===e?"":null===t?sh(e):sh(e)+":"+t},setHost:function(e){this.cannotBeABaseURL||this.parse(e,Eh)},getHostname:function(){var e=this.host;return null===e?"":sh(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,Dh)},getPort:function(){var e=this.port;return null===e?"":wf(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||(""==(e=wf(e))?this.port=null:this.parse(e,Ih))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+Uf(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,_h))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){""==(e=wf(e))?this.query=null:("?"==Mf(e,0)&&(e=Jf(e,1)),this.query="",this.parse(e,Lh)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){""!=(e=wf(e))?("#"==Mf(e,0)&&(e=Jf(e,1)),this.fragment="",this.parse(e,Uh)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Nh=function(e){var t=hf(this,Fh),r=Tf(arguments.length,1)>1?arguments[1]:void 0,n=Pf(t,new Vh(e,!1,r));sf||(t.href=n.serialize(),t.origin=n.getOrigin(),t.protocol=n.getProtocol(),t.username=n.getUsername(),t.password=n.getPassword(),t.host=n.getHost(),t.hostname=n.getHostname(),t.port=n.getPort(),t.pathname=n.getPathname(),t.search=n.getSearch(),t.searchParams=n.getSearchParams(),t.hash=n.getHash())},Fh=Nh.prototype,Hh=function(e,t){return{get:function(){return Ef(this)[e]()},set:t&&function(e){return Ef(this)[t](e)},configurable:!0,enumerable:!0}};if(sf&&(ff(Fh,"href",Hh("serialize","setHref")),ff(Fh,"origin",Hh("getOrigin")),ff(Fh,"protocol",Hh("getProtocol","setProtocol")),ff(Fh,"username",Hh("getUsername","setUsername")),ff(Fh,"password",Hh("getPassword","setPassword")),ff(Fh,"host",Hh("getHost","setHost")),ff(Fh,"hostname",Hh("getHostname","setHostname")),ff(Fh,"port",Hh("getPort","setPort")),ff(Fh,"pathname",Hh("getPathname","setPathname")),ff(Fh,"search",Hh("getSearch","setSearch")),ff(Fh,"searchParams",Hh("getSearchParams")),ff(Fh,"hash",Hh("getHash","setHash"))),pf(Fh,"toJSON",(function(){return Ef(this).serialize()}),{enumerable:!0}),pf(Fh,"toString",(function(){return Ef(this).serialize()}),{enumerable:!0}),Af){var Gh=Af.createObjectURL,zh=Af.revokeObjectURL;Gh&&pf(Nh,"createObjectURL",lf(Gh,Af)),zh&&pf(Nh,"revokeObjectURL",lf(zh,Af))}Cf(Nh,"URL"),af({global:!0,constructor:!0,forced:!cf,sham:!sf},{URL:Nh}),navigator.userAgent.indexOf("DingTalk"),Wh.sessions={},Wh.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||Wh.extension.isInstalled()}return!0};var Jh={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var t=window.setTimeout((function(){var t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)}),1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",(function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){var r=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){var n=new Error("NavigatorUserMediaError");n.name="You cancelled the request for permission, giving up...",r(n)}else r(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&(console.log("clearing ",t.data.id),window.clearTimeout(t.data.id))}))}};function Wh(e){if((e=e||{}).success="function"==typeof e.success?e.success:Wh.noop,e.error="function"==typeof e.error?e.error:Wh.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:Wh.noop,!Wh.initDone)return e.error("Library not initialized"),{};if(!Wh.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(Wh.log("Library initialized: "+Wh.initDone),!e.server)return e.error("Invalid server url"),{};var t=!1,r=null,n={},o=null,i=null,a=0,s=e.server;Wh.isArray(s)?(Wh.log("Multiple servers provided ("+s.length+"), will use the first that works"),s=null,i=e.server,Wh.debug(i)):0===s.indexOf("ws")?(t=!0,Wh.log("Using WebSockets to contact Janus: "+s)):(t=!1,Wh.log("Using REST API to contact Janus: "+s));var c=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],d=e.iceTransportPolicy,l=e.bundlePolicy,u=!0===e.ipv6,p=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(p=!0===e.withCredentials);var f=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(f=e.max_poll_events),f<1&&(f=1);var h=null;void 0!==e.token&&null!==e.token&&(h=e.token);var m=null;void 0!==e.apisecret&&null!==e.apisecret&&(m=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var v=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(v=e.keepAlivePeriod),isNaN(v)&&(v=25e3);var g=6e4;function y(e){var t={high:9e5,medium:3e5,low:1e5};return null!=e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(g=e.longPollTimeout),isNaN(g)&&(g=6e4);var b=!1,S=null,w={},C=this,T=0,R={};function k(){if(null!=S)if(Wh.debug("Long poll..."),b){var t=s+"/"+S+"?rid="+(new Date).getTime();f&&(t=t+"&maxev="+f),h&&(t=t+"&token="+encodeURIComponent(h)),m&&(t=t+"&apisecret="+encodeURIComponent(m)),Wh.httpAPICall(t,{verb:"GET",withCredentials:p,success:P,timeout:g,error:function(t,r){if(Wh.error(t+":",r),++T>3)return b=!1,void e.error("Lost connection to the server (is it down?)");k()}})}else Wh.warn("Is the server down? (connected=false)")}function P(e,n){if(T=0,t||null==S||!0===n||k(),t||!Wh.isArray(e))if("keepalive"!==e.janus)if("server_info"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus)if("trickle"===e.janus){const t=e.sender;if(!t)return void Wh.warn("Missing sender...");const r=w[t];if(!r)return void Wh.debug("This handle is not attached to this session");var o=e.candidate;Wh.debug("Got a trickled candidate on session "+S),Wh.debug(o);var i=r.webrtcStuff;i.pc&&i.remoteSdp?(Wh.debug("Adding remote candidate:",o),o&&!0!==o.completed?i.pc.addIceCandidate(o):i.pc.addIceCandidate(Wh.endOfCandidates)):(Wh.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),i.candidates||(i.candidates=[]),i.candidates.push(o),Wh.debug(i.candidates))}else{if("webrtcup"===e.janus){Wh.debug("Got a webrtcup event on session "+S),Wh.debug(e);const t=e.sender;if(!t)return void Wh.warn("Missing sender...");const r=w[t];return r?void r.webrtcState(!0):void Wh.debug("This handle is not attached to this session")}if("hangup"===e.janus){Wh.debug("Got a hangup event on session "+S),Wh.debug(e);const t=e.sender;if(!t)return void Wh.warn("Missing sender...");const r=w[t];if(!r)return void Wh.debug("This handle is not attached to this session");r.webrtcState(!1,e.reason),r.hangup()}else if("detached"===e.janus){Wh.debug("Got a detached event on session "+S),Wh.debug(e);const t=e.sender;if(!t)return void Wh.warn("Missing sender...");const r=w[t];if(!r)return;r.ondetached(),r.detach()}else if("media"===e.janus){Wh.debug("Got a media event on session "+S),Wh.debug(e);const t=e.sender;if(!t)return void Wh.warn("Missing sender...");const r=w[t];if(!r)return void Wh.debug("This handle is not attached to this session");r.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){Wh.debug("Got a slowlink event on session "+S),Wh.debug(e);const t=e.sender;if(!t)return void Wh.warn("Missing sender...");const r=w[t];if(!r)return void Wh.debug("This handle is not attached to this session");r.slowLink(e.uplink,e.lost)}else{if("error"===e.janus){Wh.error("Ooops: "+e.error.code+" "+e.error.reason),Wh.debug(e);var a=e.transaction;if(a){var s=R[a];s&&s(e),delete R[a]}return}if("event"===e.janus){Wh.debug("Got a plugin event on session "+S),Wh.debug(e);const t=e.sender;if(!t)return void Wh.warn("Missing sender...");var c=e.plugindata;if(!c)return void Wh.warn("Missing plugindata...");Wh.debug("  -- Event is coming from "+t+" ("+c.plugin+")");var d=c.data;Wh.debug(d);const r=w[t];if(!r)return void Wh.warn("This handle is not attached to this session");var l=e.jsep;l&&(Wh.debug("Handling SDP as well..."),Wh.debug(l));var u=r.onmessage;u?(Wh.debug("Notifying application..."),u(d,l)):Wh.debug("No provided notification callback")}else{if("timeout"===e.janus)return Wh.error("Timeout on session "+S),Wh.debug(e),void(t&&r.close(3504,"Gateway timeout"));Wh.warn("Unknown message/event  '"+e.janus+"' on session "+S),Wh.debug(e)}}}else{Wh.debug("Got a success on session "+S),Wh.debug(e);const t=e.transaction;if(t){const r=R[t];r&&r(e),delete R[t]}}else{Wh.debug("Got an ack on session "+S),Wh.debug(e);const t=e.transaction;if(t){const r=R[t];r&&r(e),delete R[t]}}else{Wh.debug("Got info on the Janus instance"),Wh.debug(e);const t=e.transaction;if(t){const r=R[t];r&&r(e),delete R[t]}}else Wh.vdebug("Got a keepalive on session "+S);else for(var p=0;p<e.length;p++)P(e[p],!0)}function E(){if(s&&t&&b){o=setTimeout(E,v);var e={janus:"keepalive",session_id:S,transaction:Wh.randomString(12)};h&&(e.token=h),m&&(e.apisecret=m),r.send(JSON.stringify(e))}}function D(c){var d=Wh.randomString(12),l={janus:"create",transaction:d};if(c.reconnect&&(b=!1,l.janus="claim",l.session_id=S,r&&(r.onopen=null,r.onerror=null,r.onclose=null,o&&(clearTimeout(o),o=null))),h&&(l.token=h),m&&(l.apisecret=m),!s&&Wh.isArray(i)&&(0===(s=i[a]).indexOf("ws")?(t=!0,Wh.log("Server #"+(a+1)+": trying WebSockets to contact Janus ("+s+")")):(t=!1,Wh.log("Server #"+(a+1)+": trying REST API to contact Janus ("+s+")"))),t)for(var u in r=Wh.newWebSocket(s,"janus-protocol"),n={error:function(){if(Wh.error("Error connecting to the Janus WebSockets server... "+s),Wh.isArray(i)&&!c.reconnect)return++a===i.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){D(c)}),200));c.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){R[d]=function(e){if(Wh.debug(e),"success"!==e.janus)return Wh.error("Ooops: "+e.error.code+" "+e.error.reason),void c.error(e.error.reason);o=setTimeout(E,v),b=!0,S=e.session_id?e.session_id:e.data.id,c.reconnect?Wh.log("Claimed session: "+S):Wh.log("Created session: "+S),Wh.sessions[S]=C,c.success()},r.send(JSON.stringify(l))},message:function(e){P(JSON.parse(e.data))},close:function(){s&&b&&(b=!1,e.error("Lost connection to the server (is it down?)"))}})r.addEventListener(u,n[u]);else Wh.httpAPICall(s,{verb:"POST",withCredentials:p,body:l,success:function(e){if(Wh.debug(e),"success"!==e.janus)return Wh.error("Ooops: "+e.error.code+" "+e.error.reason),void c.error(e.error.reason);b=!0,S=e.session_id?e.session_id:e.data.id,c.reconnect?Wh.log("Claimed session: "+S):Wh.log("Created session: "+S),Wh.sessions[S]=C,k(),c.success()},error:function(e,t){if(Wh.error(e+":",t),Wh.isArray(i)&&!c.reconnect)return++a===i.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){D(c)}),200));""===t?c.error(e+": Is the server down?"):t&&t.error?c.error(e+": "+t.error.message):c.error(e+": "+t)}})}function I(e,n){if((n=n||{}).success="function"==typeof n.success?n.success:Wh.noop,n.error="function"==typeof n.error?n.error:Wh.noop,!b)return Wh.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var o=w[e];if(!o||!o.webrtcStuff)return Wh.warn("Invalid handle"),void n.error("Invalid handle");var i=n.message,a=n.jsep,c=Wh.randomString(12),d={janus:"message",body:i,transaction:c};if(o.token&&(d.token=o.token),m&&(d.apisecret=m),a&&(d.jsep={type:a.type,sdp:a.sdp},a.e2ee&&(d.jsep.e2ee=!0),"hml"!==a.rid_order&&"lmh"!==a.rid_order||(d.jsep.rid_order=a.rid_order),a.force_relay&&(d.jsep.force_relay=!0)),Wh.debug("Sending message to plugin (handle="+e+"):"),Wh.debug(d),t)return d.session_id=S,d.handle_id=e,R[c]=function(e){if(Wh.debug("Message sent!"),Wh.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return Wh.warn("Request succeeded, but missing plugindata..."),void n.success();Wh.log("Synchronous transaction successful ("+t.plugin+")");var r=t.data;return Wh.debug(r),void n.success(r)}"ack"===e.janus?n.success():e.error?(Wh.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.code+" "+e.error.reason)):(Wh.error("Unknown error"),n.error("Unknown error"))},void r.send(JSON.stringify(d));Wh.httpAPICall(s+"/"+S+"/"+e,{verb:"POST",withCredentials:p,body:d,success:function(e){if(Wh.debug("Message sent!"),Wh.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return Wh.warn("Request succeeded, but missing plugindata..."),void n.success();Wh.log("Synchronous transaction successful ("+t.plugin+")");var r=t.data;return Wh.debug(r),void n.success(r)}"ack"===e.janus?n.success():e.error?(Wh.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.code+" "+e.error.reason)):(Wh.error("Unknown error"),n.error("Unknown error"))},error:function(e,t){Wh.error(e+":",t),n.error(e+": "+t)}})}function A(e,n){if(b){var o=w[e];if(o&&o.webrtcStuff){var i={janus:"trickle",candidate:n,transaction:Wh.randomString(12)};if(o.token&&(i.token=o.token),m&&(i.apisecret=m),Wh.vdebug("Sending trickle candidate (handle="+e+"):"),Wh.vdebug(i),t)return i.session_id=S,i.handle_id=e,void r.send(JSON.stringify(i));Wh.httpAPICall(s+"/"+S+"/"+e,{verb:"POST",withCredentials:p,body:i,success:function(e){Wh.vdebug("Candidate sent!"),Wh.vdebug(e),"ack"===e.janus||Wh.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,t){Wh.error(e+":",t)}})}else Wh.warn("Invalid handle")}else Wh.warn("Is the server down? (connected=false)")}function O(e,t,r,n,o){var i=w[e];if(i&&i.webrtcStuff){var a=i.webrtcStuff;if(a.pc){var s=function(e){Wh.log("Received state change on data channel:",e);var t=e.target.label,r=e.target.protocol,n=a.dataChannel[t]?a.dataChannel[t].readyState:"null";if(Wh.log("State change on <"+t+"> data channel: "+n),"open"===n){if(a.dataChannel[t].pending&&a.dataChannel[t].pending.length>0){for(var o of(Wh.log("Sending pending messages on <"+t+">:",a.dataChannel[t].pending.length),a.dataChannel[t].pending))Wh.log("Sending data on data channel <"+t+">"),Wh.debug(o),a.dataChannel[t].send(o);a.dataChannel[t].pending=[]}i.ondataopen(t,r)}};if(n)a.dataChannel[t]=n;else{var c=a.dataChannelOptions;r&&(c.protocol=r),a.dataChannel[t]=a.pc.createDataChannel(t,c)}a.dataChannel[t].onmessage=function(e){Wh.log("Received message on data channel:",e);var t=e.target.label;i.ondata(e.data,t)},a.dataChannel[t].onopen=s,a.dataChannel[t].onclose=s,a.dataChannel[t].onerror=function(e){Wh.error("Got error on data channel:",e)},a.dataChannel[t].pending=[],o&&a.dataChannel[t].pending.push(o)}else Wh.warn("Invalid PeerConnection")}else Wh.warn("Invalid handle")}function x(e,t){(t=t||{}).success="function"==typeof t.success?t.success:Wh.noop,t.error="function"==typeof t.error?t.error:Wh.noop;var r=w[e];if(!r||!r.webrtcStuff)return Wh.warn("Invalid handle"),void t.error("Invalid handle");var n=r.webrtcStuff,o=t.text||t.data;if(!o)return Wh.warn("Invalid data"),void t.error("Invalid data");var i=t.label?t.label:Wh.dataChanDefaultLabel;return n.dataChannel[i]?"open"!==n.dataChannel[i].readyState?(n.dataChannel[i].pending.push(o),void t.success()):(Wh.log("Sending data on data channel <"+i+">"),Wh.debug(o),n.dataChannel[i].send(o),void t.success()):(O(e,i,t.protocol,!1,o,t.protocol),void t.success())}function _(e,t){(t=t||{}).success="function"==typeof t.success?t.success:Wh.noop,t.error="function"==typeof t.error?t.error:Wh.noop;var r=w[e];if(!r||!r.webrtcStuff)return Wh.warn("Invalid handle"),void t.error("Invalid handle");var n=r.webrtcStuff;if(!n.dtmfSender){if(n.pc){var o=n.pc.getSenders().find((function(e){return e.track&&"audio"===e.track.kind}));if(!o)return Wh.warn("Invalid DTMF configuration (no audio track)"),void t.error("Invalid DTMF configuration (no audio track)");n.dtmfSender=o.dtmf,n.dtmfSender&&(Wh.log("Created DTMF Sender"),n.dtmfSender.ontonechange=function(e){Wh.debug("Sent DTMF tone: "+e.tone)})}if(!n.dtmfSender)return Wh.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var i=t.dtmf;if(!i)return Wh.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var a=i.tones;if(!a)return Wh.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var s="number"==typeof i.duration?i.duration:500,c="number"==typeof i.gap?i.gap:50;Wh.debug("Sending DTMF string "+a+" (duration "+s+"ms, gap "+c+"ms)"),n.dtmfSender.insertDTMF(a,s,c),t.success()}function j(e,n){(n=n||{}).success="function"==typeof n.success?n.success:Wh.noop,n.error="function"==typeof n.error?n.error:Wh.noop;var o=!0===n.noRequest;Wh.log("Destroying handle "+e+" (only-locally="+o+")"),z(e);var i=w[e];if(!i||i.detached)return delete w[e],void n.success();if(i.detached=!0,o)return delete w[e],void n.success();if(!b)return Wh.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var a={janus:"detach",transaction:Wh.randomString(12)};if(i.token&&(a.token=i.token),m&&(a.apisecret=m),t)return a.session_id=S,a.handle_id=e,r.send(JSON.stringify(a)),delete w[e],void n.success();Wh.httpAPICall(s+"/"+S+"/"+e,{verb:"POST",withCredentials:p,body:a,success:function(t){Wh.log("Destroyed handle:"),Wh.debug(t),"success"!==t.janus&&Wh.error("Ooops: "+t.error.code+" "+t.error.reason),delete w[e],n.success()},error:function(t,r){Wh.error(t+":",r),delete w[e],n.success()}})}function M(e,t,r,n,o){var i=w[e];if(!i||!i.webrtcStuff)return Wh.warn("Invalid handle"),n.stream||Wh.stopAllTracks(o),void n.error("Invalid handle");var a=i.webrtcStuff;Wh.debug("streamsDone:",o),o&&(Wh.debug("  -- Audio tracks:",o.getAudioTracks()),Wh.debug("  -- Video tracks:",o.getVideoTracks()));var s=!1;if(a.myStream&&r.update&&(!a.streamExternal||r.replaceAudio||r.replaceVideo)){if((!r.update&&J(r)||r.update&&(r.addAudio||r.replaceAudio))&&o.getAudioTracks()&&o.getAudioTracks().length)if(a.myStream.addTrack(o.getAudioTracks()[0]),Wh.unifiedPlan){Wh.log((r.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]);var p=null;const e=a.pc.getTransceivers();if(e&&e.length>0)for(const t of e)if(t.sender&&t.sender.track&&"audio"===t.sender.track.kind||t.receiver&&t.receiver.track&&"audio"===t.receiver.track.kind){p=t;break}p&&p.sender?p.sender.replaceTrack(o.getAudioTracks()[0]):a.pc.addTrack(o.getAudioTracks()[0],o)}else Wh.log((r.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]),a.pc.addTrack(o.getAudioTracks()[0],o);if((!r.update&&q(r)||r.update&&(r.addVideo||r.replaceVideo))&&o.getVideoTracks()&&o.getVideoTracks().length)if(a.myStream.addTrack(o.getVideoTracks()[0]),Wh.unifiedPlan){Wh.log((r.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]);var f=null;const e=a.pc.getTransceivers();if(e&&e.length>0)for(const t of e)if(t.sender&&t.sender.track&&"video"===t.sender.track.kind||t.receiver&&t.receiver.track&&"video"===t.receiver.track.kind){f=t;break}f&&f.sender?f.sender.replaceTrack(o.getVideoTracks()[0]):a.pc.addTrack(o.getVideoTracks()[0],o)}else Wh.log((r.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]),a.pc.addTrack(o.getVideoTracks()[0],o)}else a.myStream=o,s=!0;if(!a.pc){var h={iceServers:c,iceTransportPolicy:d,bundlePolicy:l};"chrome"===Wh.webRTCAdapter.browserDetails.browser&&(h.sdpSemantics=Wh.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var m={optional:[{DtlsSrtpKeyAgreement:!0}]};if(u&&m.optional.push({googIPv6:!0}),n.rtcConstraints&&"object"==typeof n.rtcConstraints)for(var v in Wh.debug("Adding custom PeerConnection constraints:",n.rtcConstraints),n.rtcConstraints)m.optional.push(n.rtcConstraints[v]);"edge"===Wh.webRTCAdapter.browserDetails.browser&&(h.bundlePolicy="max-bundle"),RTCRtpSender&&(RTCRtpSender.prototype.createEncodedStreams||RTCRtpSender.prototype.createEncodedAudioStreams&&RTCRtpSender.prototype.createEncodedVideoStreams)&&(n.senderTransforms||n.receiverTransforms)&&(a.senderTransforms=n.senderTransforms,a.receiverTransforms=n.receiverTransforms,h.forceEncodedAudioInsertableStreams=!0,h.forceEncodedVideoInsertableStreams=!0,h.encodedInsertableStreams=!0),Wh.log("Creating PeerConnection"),Wh.debug(m),a.pc=new RTCPeerConnection(h,m),Wh.debug(a.pc),a.pc.getStats&&(a.volume={},a.bitrate.value="0 kbits/sec"),Wh.log("Preparing local SDP and gathering candidates (trickle="+a.trickle+")"),a.pc.oniceconnectionstatechange=function(){a.pc&&i.iceState(a.pc.iceConnectionState)},a.pc.onicecandidate=function(t){if(!t.candidate||"edge"===Wh.webRTCAdapter.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)Wh.log("End of candidates."),a.iceDone=!0,!0===a.trickle?A(e,{completed:!0}):function(e,t){t=t||{},t.success="function"==typeof t.success?t.success:Wh.noop,t.error="function"==typeof t.error?t.error:Wh.noop;var r=w[e];if(!r||!r.webrtcStuff)return void Wh.warn("Invalid handle, not sending anything");var n=r.webrtcStuff;if(Wh.log("Sending offer/answer SDP..."),!n.mySdp)return void Wh.warn("Local SDP instance is invalid, not sending anything...");n.mySdp={type:n.pc.localDescription.type,sdp:n.pc.localDescription.sdp},!1===n.trickle&&(n.mySdp.trickle=!1);Wh.debug(t),n.sdpSent=!0,t.success(n.mySdp)}(e,n);else{var r=t.candidate.candidate;if(!u){var o=r.split(" "),i=o[4].match(/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/);i&&""!=i||(o[4]="127.0.0.1"),r=o.join(" ")}var s={candidate:r,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===a.trickle&&A(e,s)}},a.pc.ontrack=function(e){if(Wh.log("Handling Remote Track"),Wh.debug(e),e.streams){a.remoteStream=e.streams[0];try{i.onremotestream(a.remoteStream)}catch(e){Wh.error(e)}if(!e.track.onended){if(a.receiverTransforms){var t=null;RTCRtpSender.prototype.createEncodedStreams?t=e.receiver.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===e.track.kind&&a.receiverTransforms.audio?t=e.receiver.createEncodedAudioStreams():"video"===e.track.kind&&a.receiverTransforms.video&&(t=e.receiver.createEncodedVideoStreams())),t&&(console.log(t),t.readableStream&&t.writableStream?t.readableStream.pipeThrough(a.receiverTransforms[e.track.kind]).pipeTo(t.writableStream):t.readable&&t.writable&&t.readable.pipeThrough(a.receiverTransforms[e.track.kind]).pipeTo(t.writable))}var r=null;Wh.log("Adding onended callback to track:",e.track),e.track.onended=function(e){if(Wh.log("Remote track removed:",e),a.remoteStream){clearTimeout(r),a.remoteStream.removeTrack(e.target);try{i.onremotestream(a.remoteStream)}catch(e){Wh.error(e)}}},e.track.onmute=function(e){Wh.log("Remote track muted:",e),a.remoteStream&&null==r&&(r=setTimeout((function(){if(Wh.log("Removing remote track"),a.remoteStream){a.remoteStream.removeTrack(e.target);try{i.onremotestream(a.remoteStream)}catch(e){Wh.error(e)}}r=null}),2520))},e.track.onunmute=function(e){if(Wh.log("Remote track flowing again:",e),null!=r)clearTimeout(r),r=null;else try{a.remoteStream.addTrack(e.target),i.onremotestream(a.remoteStream)}catch(e){Wh.error(e)}}}}}}if(s&&o){Wh.log("Adding local stream");var g=!0===n.simulcast2;o.getTracks().forEach((function(e){Wh.log("Adding local track:",e);var t=null;if(g&&"audio"!==e.kind){Wh.log("Enabling rid-based simulcasting:",e);var r=y(n.simulcastMaxBitrates),i=a.pc.addTransceiver(e,{direction:"sendrecv",streams:[o],sendEncodings:n.sendEncodings||[{rid:"h",active:!0,maxBitrate:r.high},{rid:"m",active:!0,maxBitrate:r.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:r.low,scaleResolutionDownBy:4}]});i&&(t=i.sender)}else t=a.pc.addTrack(e,o);if(t&&a.senderTransforms){var s=null;RTCRtpSender.prototype.createEncodedStreams?s=t.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===t.track.kind&&a.senderTransforms.audio?s=t.createEncodedAudioStreams():"video"===t.track.kind&&a.senderTransforms.video&&(s=t.createEncodedVideoStreams())),s&&(console.log(s),s.readableStream&&s.writableStream?s.readableStream.pipeThrough(a.senderTransforms[t.track.kind]).pipeTo(s.writableStream):s.readable&&s.writable&&s.readable.pipeThrough(a.senderTransforms[t.track.kind]).pipeTo(s.writable))}}))}if(function(e){if(Wh.debug("isDataEnabled:",e),"edge"===Wh.webRTCAdapter.browserDetails.browser)return Wh.warn("Edge doesn't support data channels yet"),!1;return null!=e&&!0===e.data}(r)&&!a.dataChannel[Wh.dataChanDefaultLabel]&&(Wh.log("Creating default data channel"),O(e,Wh.dataChanDefaultLabel,null,!1),a.pc.ondatachannel=function(t){Wh.log("Data channel created by Janus:",t),O(e,t.channel.label,t.channel.protocol,t.channel)}),a.myStream)try{i.onlocalstream(a.myStream)}catch(e){Wh.error(e)}t?a.pc.setRemoteDescription(t).then((function(){if(Wh.log("Remote description accepted!"),a.remoteSdp=t.sdp,a.candidates&&a.candidates.length>0){for(var o=0;o<a.candidates.length;o++){var i=a.candidates[o];Wh.debug("Adding remote candidate:",i),i&&!0!==i.completed?a.pc.addIceCandidate(i):a.pc.addIceCandidate(Wh.endOfCandidates)}a.candidates=[]}!function(e,t,r){r=r||{},r.success="function"==typeof r.success?r.success:Wh.noop,r.error="function"==typeof r.error?r.error:Wh.noop,r.customizeSdp="function"==typeof r.customizeSdp?r.customizeSdp:Wh.noop;var n=w[e];if(!n||!n.webrtcStuff)return Wh.warn("Invalid handle"),void r.error("Invalid handle");var o=n.webrtcStuff,i=!0===r.simulcast;i?Wh.log("Creating answer (iceDone="+o.iceDone+", simulcast="+i+")"):Wh.log("Creating answer (iceDone="+o.iceDone+")");var a=null;if(Wh.unifiedPlan){a={};var s=null,c=null,d=o.pc.getTransceivers();if(d&&d.length>0)for(var l of d)l.sender&&l.sender.track&&"audio"===l.sender.track.kind||l.receiver&&l.receiver.track&&"audio"===l.receiver.track.kind?s||(s=l):(l.sender&&l.sender.track&&"video"===l.sender.track.kind||l.receiver&&l.receiver.track&&"video"===l.receiver.track.kind)&&(c||(c=l));var u=J(t),p=W(t);if(u||p){if(u&&p){if(s)try{s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",Wh.log("Setting audio transceiver to sendrecv:",s)}catch(e){Wh.error(e)}}else if(u&&!p)try{s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",Wh.log("Setting audio transceiver to sendonly:",s))}catch(e){Wh.error(e)}else if(!u&&p)if(s)try{s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",Wh.log("Setting audio transceiver to recvonly:",s)}catch(e){Wh.error(e)}else s=o.pc.addTransceiver("audio",{direction:"recvonly"}),Wh.log("Adding recvonly audio transceiver:",s)}else if(t.removeAudio&&s)try{s.setDirection?s.setDirection("inactive"):s.direction="inactive",Wh.log("Setting audio transceiver to inactive:",s)}catch(e){Wh.error(e)}var f=q(t),h=B(t);if(f||h){if(f&&h){if(c)try{c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",Wh.log("Setting video transceiver to sendrecv:",c)}catch(e){Wh.error(e)}}else if(f&&!h){if(c)try{c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",Wh.log("Setting video transceiver to sendonly:",c)}catch(e){Wh.error(e)}}else if(!f&&h)if(c)try{c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",Wh.log("Setting video transceiver to recvonly:",c)}catch(e){Wh.error(e)}else c=o.pc.addTransceiver("video",{direction:"recvonly"}),Wh.log("Adding recvonly video transceiver:",c)}else if(t.removeVideo&&c)try{c.setDirection?c.setDirection("inactive"):c.direction="inactive",Wh.log("Setting video transceiver to inactive:",c)}catch(e){Wh.error(e)}}else a="firefox"===Wh.webRTCAdapter.browserDetails.browser||"edge"===Wh.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:W(t),offerToReceiveVideo:B(t)}:{mandatory:{OfferToReceiveAudio:W(t),OfferToReceiveVideo:B(t)}};Wh.debug(a);var m=q(t);if(m&&i&&"firefox"===Wh.webRTCAdapter.browserDetails.browser){Wh.log("Enabling Simulcasting for Firefox (RID)");var v=o.pc.getSenders()[1];Wh.log(v);var g=v.getParameters();Wh.log(g);var b=y(r.simulcastMaxBitrates);v.setParameters({encodings:r.sendEncodings||[{rid:"h",active:!0,maxBitrate:b.high},{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:b.low,scaleResolutionDownBy:4}]})}o.pc.createAnswer(a).then((function(e){Wh.debug(e);var t={type:e.type,sdp:e.sdp};r.customizeSdp(t),e.sdp=t.sdp,Wh.log("Setting local description"),m&&i&&("chrome"===Wh.webRTCAdapter.browserDetails.browser?Wh.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==Wh.webRTCAdapter.browserDetails.browser&&Wh.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp={type:"answer",sdp:e.sdp},o.pc.setLocalDescription(e).catch(r.error),o.mediaConstraints=a,o.iceDone||o.trickle?((o.senderTransforms||o.receiverTransforms)&&(e.e2ee=!0),r.success(e)):Wh.log("Waiting for all candidates...")}),r.error)}(e,r,n)}),n.error):function(e,t,r){r=r||{},r.success="function"==typeof r.success?r.success:Wh.noop,r.error="function"==typeof r.error?r.error:Wh.noop,r.customizeSdp="function"==typeof r.customizeSdp?r.customizeSdp:Wh.noop;var n=w[e];if(!n||!n.webrtcStuff)return Wh.warn("Invalid handle"),void r.error("Invalid handle");var o=n.webrtcStuff,i=!0===r.simulcast;i?Wh.log("Creating offer (iceDone="+o.iceDone+", simulcast="+i+")"):Wh.log("Creating offer (iceDone="+o.iceDone+")");var a={};if(Wh.unifiedPlan){var s=null,c=null,d=o.pc.getTransceivers();if(d&&d.length>0)for(var l of d)l.sender&&l.sender.track&&"audio"===l.sender.track.kind||l.receiver&&l.receiver.track&&"audio"===l.receiver.track.kind?s||(s=l):(l.sender&&l.sender.track&&"video"===l.sender.track.kind||l.receiver&&l.receiver.track&&"video"===l.receiver.track.kind)&&(c||(c=l));var u=J(t),p=W(t);u||p?u&&p?s&&(s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",Wh.log("Setting audio transceiver to sendrecv:",s)):u&&!p?s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",Wh.log("Setting audio transceiver to sendonly:",s)):!u&&p&&(s?(s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",Wh.log("Setting audio transceiver to recvonly:",s)):(s=o.pc.addTransceiver("audio",{direction:"recvonly"}),Wh.log("Adding recvonly audio transceiver:",s))):t.removeAudio&&s&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive",Wh.log("Setting audio transceiver to inactive:",s));var f=q(t),h=B(t);f||h?f&&h?c&&(c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",Wh.log("Setting video transceiver to sendrecv:",c)):f&&!h?c&&(c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",Wh.log("Setting video transceiver to sendonly:",c)):!f&&h&&(c?(c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",Wh.log("Setting video transceiver to recvonly:",c)):(c=o.pc.addTransceiver("video",{direction:"recvonly"}),Wh.log("Adding recvonly video transceiver:",c))):t.removeVideo&&c&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive",Wh.log("Setting video transceiver to inactive:",c)),a.offerToReceiveVideo=B(t)}else a.offerToReceiveAudio=W(t),a.offerToReceiveVideo=B(t);var m=!0===r.iceRestart;m&&(a.iceRestart=!0);Wh.debug(a);var v=q(t);if(v&&i&&"firefox"===Wh.webRTCAdapter.browserDetails.browser){Wh.log("Enabling Simulcasting for Firefox (RID)");var g=o.pc.getSenders().find((function(e){return e.track&&"video"===e.track.kind}));if(g){var b=g.getParameters();b||(b={});var S=y(r.simulcastMaxBitrates);b.encodings=r.sendEncodings||[{rid:"h",active:!0,maxBitrate:S.high},{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:S.low,scaleResolutionDownBy:4}],g.setParameters(b)}}o.pc.createOffer(a).then((function(e){Wh.debug(e);var t={type:e.type,sdp:e.sdp};r.customizeSdp(t),e.sdp=t.sdp,Wh.log("Setting local description"),v&&i&&("chrome"===Wh.webRTCAdapter.browserDetails.browser||"safari"===Wh.webRTCAdapter.browserDetails.browser?(Wh.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=function(e){var t=e.split("\r\n"),r=!1,n=[-1],o=[-1],i=null,a=null,s=null,c=null,d=-1;for(let p=0;p<t.length;p++){const f=t[p].match(/m=(\w+) */);if(f){if("video"===f[1]){if(!(n[0]<0)){d=p;break}r=!0}else if(n[0]>-1){d=p;break}}else if(r){if(t[p].match(/a=ssrc-group:SIM (\d+) (\d+) (\d+)/))return Wh.warn("The SDP already contains a SIM attribute, munging will be skipped"),e;var l=t[p].match(/a=ssrc-group:FID (\d+) (\d+)/);if(l)n[0]=l[1],o[0]=l[2],t.splice(p,1),p--;else{if(n[0]){var u=t[p].match("a=ssrc:"+n[0]+" cname:(.+)");if(u&&(i=u[1]),(u=t[p].match("a=ssrc:"+n[0]+" msid:(.+)"))&&(a=u[1]),(u=t[p].match("a=ssrc:"+n[0]+" mslabel:(.+)"))&&(s=u[1]),(u=t[p].match("a=ssrc:"+n[0]+" label:(.+)"))&&(c=u[1]),0===t[p].indexOf("a=ssrc:"+o[0])){t.splice(p,1),p--;continue}if(0===t[p].indexOf("a=ssrc:"+n[0])){t.splice(p,1),p--;continue}}0!=t[p].length||(t.splice(p,1),p--)}}}if(n[0]<0){d=-1,r=!1;for(let e=0;e<t.length;e++){const l=t[e].match(/m=(\w+) */);if(l){if("video"===l[1]){if(!(n[0]<0)){d=e;break}r=!0}else if(n[0]>-1){d=e;break}}else if(r){if(n[0]<0){var p=t[e].match(/a=ssrc:(\d+)/);if(p){n[0]=p[1],t.splice(e,1),e--;continue}}else{let r=t[e].match("a=ssrc:"+n[0]+" cname:(.+)");if(r&&(i=r[1]),r=t[e].match("a=ssrc:"+n[0]+" msid:(.+)"),r&&(a=r[1]),r=t[e].match("a=ssrc:"+n[0]+" mslabel:(.+)"),r&&(s=r[1]),r=t[e].match("a=ssrc:"+n[0]+" label:(.+)"),r&&(c=r[1]),0===t[e].indexOf("a=ssrc:"+o[0])){t.splice(e,1),e--;continue}if(0===t[e].indexOf("a=ssrc:"+n[0])){t.splice(e,1),e--;continue}}0!==t[e].length||(t.splice(e,1),e--)}}}if(n[0]<0)return Wh.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;d<0&&(d=t.length);n[1]=Math.floor(4294967295*Math.random()),n[2]=Math.floor(4294967295*Math.random()),o[1]=Math.floor(4294967295*Math.random()),o[2]=Math.floor(4294967295*Math.random());for(var f=0;f<n.length;f++)i&&(t.splice(d,0,"a=ssrc:"+n[f]+" cname:"+i),d++),a&&(t.splice(d,0,"a=ssrc:"+n[f]+" msid:"+a),d++),s&&(t.splice(d,0,"a=ssrc:"+n[f]+" mslabel:"+s),d++),c&&(t.splice(d,0,"a=ssrc:"+n[f]+" label:"+c),d++),i&&(t.splice(d,0,"a=ssrc:"+o[f]+" cname:"+i),d++),a&&(t.splice(d,0,"a=ssrc:"+o[f]+" msid:"+a),d++),s&&(t.splice(d,0,"a=ssrc:"+o[f]+" mslabel:"+s),d++),c&&(t.splice(d,0,"a=ssrc:"+o[f]+" label:"+c),d++);t.splice(d,0,"a=ssrc-group:FID "+n[2]+" "+o[2]),t.splice(d,0,"a=ssrc-group:FID "+n[1]+" "+o[1]),t.splice(d,0,"a=ssrc-group:FID "+n[0]+" "+o[0]),t.splice(d,0,"a=ssrc-group:SIM "+n[0]+" "+n[1]+" "+n[2]),e=t.join("\r\n"),e.endsWith("\r\n")||(e+="\r\n");return e}(e.sdp)):"firefox"!==Wh.webRTCAdapter.browserDetails.browser&&Wh.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp={type:"offer",sdp:e.sdp},o.pc.setLocalDescription(e).catch(r.error),o.mediaConstraints=a,o.iceDone||o.trickle?((o.senderTransforms||o.receiverTransforms)&&(e.e2ee=!0),r.success(e)):Wh.log("Waiting for all candidates...")}),r.error)}(e,r,n)}function L(e,t,r){(r=r||{}).success="function"==typeof r.success?r.success:Wh.noop,r.error="function"==typeof r.error?r.error:G;var n=r.jsep;if(t&&n)return Wh.error("Provided a JSEP to a createOffer"),void r.error("Provided a JSEP to a createOffer");if(!(t||n&&n.type&&n.sdp))return Wh.error("A valid JSEP is required for createAnswer"),void r.error("A valid JSEP is required for createAnswer");r.media="object"==typeof r.media&&r.media?r.media:{audio:!0,video:!0};var o=r.media,i=w[e];if(!i||!i.webrtcStuff)return Wh.warn("Invalid handle"),void r.error("Invalid handle");var a,s=i.webrtcStuff;if(s.trickle=(a=r.trickle,Wh.debug("isTrickleEnabled:",a),!1!==a),s.pc){if(Wh.log("Updating existing media session"),o.update=!0,r.stream)r.stream!==s.myStream&&Wh.log("Renegotiation involves a new external stream");else{if(o.addAudio){if(o.keepAudio=!1,o.replaceAudio=!1,o.removeAudio=!1,o.audioSend=!0,s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length)return Wh.error("Can't add audio stream, there already is one"),void r.error("Can't add audio stream, there already is one")}else o.removeAudio?(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!1,o.audioSend=!1):o.replaceAudio&&(o.keepAudio=!1,o.addAudio=!1,o.removeAudio=!1,o.audioSend=!0);if(s.myStream&&s.myStream.getAudioTracks()&&0!==s.myStream.getAudioTracks().length?!J(o)||o.removeAudio||o.replaceAudio||(o.keepAudio=!0):(o.replaceAudio&&(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!0,o.audioSend=!0),J(o)&&(o.keepAudio=!1,o.addAudio=!0)),o.addVideo){if(o.keepVideo=!1,o.replaceVideo=!1,o.removeVideo=!1,o.videoSend=!0,s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length)return Wh.error("Can't add video stream, there already is one"),void r.error("Can't add video stream, there already is one")}else o.removeVideo?(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!1,o.videoSend=!1):o.replaceVideo&&(o.keepVideo=!1,o.addVideo=!1,o.removeVideo=!1,o.videoSend=!0);s.myStream&&s.myStream.getVideoTracks()&&0!==s.myStream.getVideoTracks().length?!q(o)||o.removeVideo||o.replaceVideo||(o.keepVideo=!0):(o.replaceVideo&&(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!0,o.videoSend=!0),q(o)&&(o.keepVideo=!1,o.addVideo=!0)),o.addData&&(o.data=!0)}if(J(o)&&o.keepAudio&&q(o)&&o.keepVideo)return i.consentDialog(!1),void M(e,n,o,r,s.myStream)}else o.update=!1,o.keepAudio=!1,o.keepVideo=!1;if(o.update&&(!s.streamExternal||s.streamExternal&&(o.replaceAudio||o.replaceVideo))){if(o.removeAudio||o.replaceAudio){if(s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length){var c=s.myStream.getAudioTracks()[0];Wh.log("Removing audio track:",c),s.myStream.removeTrack(c);try{c.stop()}catch(e){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var d=!0;if(o.replaceAudio&&Wh.unifiedPlan&&(d=!1),d)for(var l of s.pc.getSenders())l&&l.track&&"audio"===l.track.kind&&(Wh.log("Removing audio sender:",l),s.pc.removeTrack(l))}}if(o.removeVideo||o.replaceVideo){if(s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length){var u=s.myStream.getVideoTracks()[0];Wh.log("Removing video track:",u),s.myStream.removeTrack(u);try{u.stop()}catch(e){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var p=!0;if(o.replaceVideo&&Wh.unifiedPlan&&(p=!1),p)for(var f of s.pc.getSenders())f&&f.track&&"video"===f.track.kind&&(Wh.log("Removing video sender:",f),s.pc.removeTrack(f))}}}if(r.stream){var h=r.stream;return Wh.log("MediaStream provided by the application"),Wh.debug(h),!o.update||!s.myStream||s.myStream===r.stream||s.streamExternal||o.replaceAudio||o.replaceVideo||(Wh.stopAllTracks(s.myStream),s.myStream=null),s.streamExternal=!0,i.consentDialog(!1),void M(e,n,o,r,h)}if(J(o)||q(o)){if(!Wh.isGetUserMediaAvailable())return void r.error("getUserMedia not available");var m={mandatory:{},optional:[]};i.consentDialog(!0);var v=J(o);v&&o&&"object"==typeof o.audio&&(v=o.audio);var g=q(o);if(g&&o){var y=!0===r.simulcast,b=!0===r.simulcast2;if(!y&&!b||n||o.video||(o.video="hires"),o.video&&"screen"!=o.video&&"window"!=o.video)if("object"==typeof o.video)g=o.video;else{var S=0,C=0;"lowres"===o.video?(C=240,S=320):"lowres-16:9"===o.video?(C=180,S=320):"hires"===o.video||"hires-16:9"===o.video||"hdres"===o.video?(C=720,S=1280):"fhdres"===o.video?(C=1080,S=1920):"4kres"===o.video?(C=2160,S=3840):"stdres"===o.video?(C=480,S=640):"stdres-16:9"===o.video?(C=360,S=640):(Wh.log("Default video setting is stdres 4:3"),C=480,S=640),Wh.log("Adding media constraint:",o.video),g={height:{ideal:C},width:{ideal:S}},Wh.log("Adding video constraint:",g)}else if("screen"===o.video||"window"===o.video){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return m.video={},o.screenshareFrameRate&&(m.video.frameRate=o.screenshareFrameRate),o.screenshareHeight&&(m.video.height=o.screenshareHeight),o.screenshareWidth&&(m.video.width=o.screenshareWidth),m.audio=o.captureDesktopAudio,void navigator.mediaDevices.getDisplayMedia(m).then((function(t){i.consentDialog(!1),J(o)&&!o.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(i){t.addTrack(i.getAudioTracks()[0]),M(e,n,o,r,t)})):M(e,n,o,r,t)}),(function(e){i.consentDialog(!1),r.error(e)}));const t=function(t,a){i.consentDialog(!1),t?r.error(t):M(e,n,o,r,a)},a=function(e,t,r){Wh.log("Adding media constraint (screen capture)"),Wh.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){r?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(r){e.addTrack(r.getAudioTracks()[0]),t(null,e)})):t(null,e)})).catch((function(e){i.consentDialog(!1),t(e)}))};if("chrome"===Wh.webRTCAdapter.browserDetails.browser){var T=Wh.webRTCAdapter.browserDetails.version,R=33;window.navigator.userAgent.match("Linux")&&(R=35),T>=26&&T<=R?(m={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate,chromeMediaSource:"screen"}},audio:J(o)&&!o.keepAudio},a(m,t)):Wh.extension.getScreen((function(e,n){if(e)return i.consentDialog(!1),r.error(e);(m={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=n,a(m,t,J(o)&&!o.keepAudio)}))}else if("firefox"===Wh.webRTCAdapter.browserDetails.browser){if(!(Wh.webRTCAdapter.browserDetails.version>=33)){var k=new Error("NavigatorUserMediaError");return k.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",i.consentDialog(!1),void r.error(k)}m={video:{mozMediaSource:o.video,mediaSource:o.video},audio:J(o)&&!o.keepAudio},a(m,(function(e,r){if(t(e,r),!e)var n=r.currentTime,o=window.setInterval((function(){r||window.clearInterval(o),r.currentTime==n&&(window.clearInterval(o),r.onended&&r.onended()),n=r.currentTime}),500)}))}return}}o&&"screen"===o.video||navigator.mediaDevices.enumerateDevices().then((function(t){var a=t.some((function(e){return"audioinput"===e.kind})),s=function(e){if(Wh.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!=typeof e.video||"object"!=typeof e.video.mandatory)return!1;var t=e.video.mandatory;if(t.chromeMediaSource)return"desktop"===t.chromeMediaSource||"screen"===t.chromeMediaSource;if(t.mozMediaSource)return"window"===t.mozMediaSource||"screen"===t.mozMediaSource;if(t.mediaSource)return"window"===t.mediaSource||"screen"===t.mediaSource;return!1}(o)||t.some((function(e){return"videoinput"===e.kind})),c=J(o),d=q(o),l=function(e){return Wh.debug("isAudioSendRequired:",e),!!e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}(o),u=function(e){return Wh.debug("isVideoSendRequired:",e),!!e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}(o);if(c||d||l||u){var p=!!c&&a,f=!!d&&s;if(!p&&!f)return i.consentDialog(!1),r.error("No capture device found"),!1;if(!p&&l)return i.consentDialog(!1),r.error("Audio capture is required, but no capture device found"),!1;if(!f&&u)return i.consentDialog(!1),r.error("Video capture is required, but no capture device found"),!1}var m={audio:!(!a||o.keepAudio)&&v,video:!(!s||o.keepVideo)&&g};Wh.debug("getUserMedia constraints",m),m.audio||m.video?(console.log("gumConstraints",m),navigator.mediaDevices.getUserMedia(m).then((function(t){i.consentDialog(!1),M(e,n,o,r,t)})).catch((function(e){console.error("getUserMedia() fail.",e),i.consentDialog(!1),r.error({code:e.code,name:e.name,message:e.message})}))):(i.consentDialog(!1),M(e,n,o,r,h))})).catch((function(e){console.error("enumerateDevices() fail.",e),i.consentDialog(!1),r.error(e)}))}else M(e,n,o,r)}function U(e,t){(t=t||{}).success="function"==typeof t.success?t.success:Wh.noop,t.error="function"==typeof t.error?t.error:G,t.customizeSdp="function"==typeof t.customizeSdp?t.customizeSdp:Wh.noop;var r=t.jsep,n=w[e];if(!n||!n.webrtcStuff)return Wh.warn("Invalid handle"),void t.error("Invalid handle");var o=n.webrtcStuff;if(r){if(!o.pc)return Wh.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");t.customizeSdp(r),o.pc.setRemoteDescription(r).then((function(){if(Wh.log("Remote description accepted!"),o.remoteSdp=r.sdp,o.candidates&&o.candidates.length>0){for(var e=0;e<o.candidates.length;e++){var n=o.candidates[e];Wh.debug("Adding remote candidate:",n),n&&!0!==n.completed?o.pc.addIceCandidate(n):o.pc.addIceCandidate(Wh.endOfCandidates)}o.candidates=[]}t.success()}),t.error)}else t.error("Invalid JSEP")}function V(e,t){var r=w[e];if(!r||!r.webrtcStuff)return Wh.warn("Invalid handle"),0;var n=t?"remote":"local",o=r.webrtcStuff;return o.volume[n]||(o.volume[n]={value:0}),!o.pc.getStats||"chrome"!==Wh.webRTCAdapter.browserDetails.browser&&"safari"!==Wh.webRTCAdapter.browserDetails.browser?(Wh.warn("Getting the "+n+" volume unsupported by browser"),0):t&&!o.remoteStream?(Wh.warn("Remote stream unavailable"),0):t||o.myStream?o.volume[n].timer?o.volume[n].value:(Wh.log("Starting "+n+" volume monitor"),o.volume[n].timer=setInterval((function(){o.pc.getStats().then((function(e){e.forEach((function(e){e&&"audio"===e.kind&&(t&&!e.remoteSource||!t&&"media-source"!==e.type||(o.volume[n].value=e.audioLevel?e.audioLevel:0))}))}))}),200),0):(Wh.warn("Local stream unavailable"),0)}function N(e,t){var r=w[e];if(!r||!r.webrtcStuff)return Wh.warn("Invalid handle"),!0;var n=r.webrtcStuff;return n.pc?n.myStream?t?n.myStream.getVideoTracks()&&0!==n.myStream.getVideoTracks().length?!n.myStream.getVideoTracks()[0].enabled:(Wh.warn("No video track"),!0):n.myStream.getAudioTracks()&&0!==n.myStream.getAudioTracks().length?!n.myStream.getAudioTracks()[0].enabled:(Wh.warn("No audio track"),!0):(Wh.warn("Invalid local MediaStream"),!0):(Wh.warn("Invalid PeerConnection"),!0)}function F(e,t,r){var n=w[e];if(!n||!n.webrtcStuff)return Wh.warn("Invalid handle"),!1;var o=n.webrtcStuff;return o.pc?o.myStream?t?o.myStream.getVideoTracks()&&0!==o.myStream.getVideoTracks().length?(o.myStream.getVideoTracks()[0].enabled=!r,!0):(Wh.warn("No video track"),!1):o.myStream.getAudioTracks()&&0!==o.myStream.getAudioTracks().length?(o.myStream.getAudioTracks()[0].enabled=!r,!0):(Wh.warn("No audio track"),!1):(Wh.warn("Invalid local MediaStream"),!1):(Wh.warn("Invalid PeerConnection"),!1)}function H(e){var t=w[e];if(!t||!t.webrtcStuff)return Wh.warn("Invalid handle"),"Invalid handle";var r=t.webrtcStuff;return r.pc?r.pc.getStats?r.bitrate.timer?r.bitrate.value:(Wh.log("Starting bitrate timer (via getStats)"),r.bitrate.timer=setInterval((function(){r.pc.getStats().then((function(e){e.forEach((function(e){if(e){var t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(r.bitrate.bsnow=e.bytesReceived,r.bitrate.tsnow=e.timestamp,null===r.bitrate.bsbefore||null===r.bitrate.tsbefore)r.bitrate.bsbefore=r.bitrate.bsnow,r.bitrate.tsbefore=r.bitrate.tsnow;else{var n=r.bitrate.tsnow-r.bitrate.tsbefore;"safari"===Wh.webRTCAdapter.browserDetails.browser&&(n/=1e3);var o=Math.round(8*(r.bitrate.bsnow-r.bitrate.bsbefore)/n);"safari"===Wh.webRTCAdapter.browserDetails.browser&&(o=parseInt(o/1e3)),r.bitrate.value=o+" kbits/sec",r.bitrate.bsbefore=r.bitrate.bsnow,r.bitrate.tsbefore=r.bitrate.tsnow}}}))}))}),1e3),"0 kbits/sec"):(Wh.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"):"Invalid PeerConnection"}function G(e){Wh.error("WebRTC error:",e)}function z(e,n){Wh.log("Cleaning WebRTC stuff");var o=w[e];if(o){var i=o.webrtcStuff;if(i){if(!0===n){var a={janus:"hangup",transaction:Wh.randomString(12)};o.token&&(a.token=o.token),m&&(a.apisecret=m),Wh.debug("Sending hangup request (handle="+e+"):"),Wh.debug(a),t?(a.session_id=S,a.handle_id=e,r.send(JSON.stringify(a))):Wh.httpAPICall(s+"/"+S+"/"+e,{verb:"POST",withCredentials:p,body:a})}i.remoteStream=null,i.volume&&(i.volume.local&&i.volume.local.timer&&clearInterval(i.volume.local.timer),i.volume.remote&&i.volume.remote.timer&&clearInterval(i.volume.remote.timer)),i.volume={},i.bitrate.timer&&clearInterval(i.bitrate.timer),i.bitrate.timer=null,i.bitrate.bsnow=null,i.bitrate.bsbefore=null,i.bitrate.tsnow=null,i.bitrate.tsbefore=null,i.bitrate.value=null,!i.streamExternal&&i.myStream&&(Wh.log("Stopping local stream tracks"),Wh.stopAllTracks(i.myStream)),i.streamExternal=!1,i.myStream=null;try{i.pc.close()}catch(e){}i.pc=null,i.candidates=null,i.mySdp=null,i.remoteSdp=null,i.iceDone=!1,i.dataChannel={},i.dtmfSender=null,i.senderTransforms=null,i.receiverTransforms=null}o.oncleanup()}}function J(e){return Wh.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function W(e){return Wh.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function q(e){return Wh.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function B(e){return Wh.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}D(e),this.getServer=function(){return s},this.isConnected=function(){return b},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:Wh.noop,e.error="function"==typeof e.error?e.error:Wh.noop,e.reconnect=!0,D(e)},this.getSessionId=function(){return S},this.getInfo=function(e){!function(e){if(e=e||{},e.success="function"==typeof e.success?e.success:Wh.noop,e.error="function"==typeof e.error?e.error:Wh.noop,Wh.log("Getting info on Janus instance"),!b)return Wh.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var n=Wh.randomString(12),o={janus:"info",transaction:n};h&&(o.token=h);m&&(o.apisecret=m);if(t)return R[n]=function(t){Wh.log("Server info:"),Wh.debug(t),"server_info"!==t.janus&&Wh.error("Ooops: "+t.error.code+" "+t.error.reason),e.success(t)},void r.send(JSON.stringify(o));Wh.httpAPICall(s,{verb:"POST",withCredentials:p,body:o,success:function(t){Wh.log("Server info:"),Wh.debug(t),"server_info"!==t.janus&&Wh.error("Ooops: "+t.error.code+" "+t.error.reason),e.success(t)},error:function(t,r){Wh.error(t+":",r),""===r?e.error(t+": Is the server down?"):e.error(t+": "+r)}})}(e)},this.destroy=function(i){!function(i){i=i||{},i.success="function"==typeof i.success?i.success:Wh.noop,i.error="function"==typeof i.error?i.error:Wh.noop;var a=!0===i.unload,c=!0;void 0!==i.notifyDestroyed&&null!==i.notifyDestroyed&&(c=!0===i.notifyDestroyed);var d=!0===i.cleanupHandles;if(Wh.log("Destroying session "+S+" (unload="+a+")"),!S)return Wh.warn("No session to destroy"),i.success(),void(c&&e.destroyed());if(d)for(var l in w)j(l,{noRequest:!0});if(!b)return Wh.warn("Is the server down? (connected=false)"),S=null,void i.success();var u={janus:"destroy",transaction:Wh.randomString(12)};h&&(u.token=h);m&&(u.apisecret=m);if(a)return t?(r.onclose=null,r.close(),r=null):navigator.sendBeacon(s+"/"+S,JSON.stringify(u)),Wh.log("Destroyed session:"),S=null,b=!1,i.success(),void(c&&e.destroyed());if(t){u.session_id=S;var f=function(){for(var e in n)r.removeEventListener(e,n[e]);r.removeEventListener("message",v),r.removeEventListener("error",g),o&&clearTimeout(o),r.close()},v=function(t){var r=JSON.parse(t.data);r.session_id==u.session_id&&r.transaction==u.transaction&&(f(),i.success(),c&&e.destroyed())},g=function(){f(),i.error("Failed to destroy the server: Is the server down?"),c&&e.destroyed()};return r.addEventListener("message",v),r.addEventListener("error",g),void(1===r.readyState?r.send(JSON.stringify(u)):g())}Wh.httpAPICall(s+"/"+S,{verb:"POST",withCredentials:p,body:u,success:function(t){Wh.log("Destroyed session:"),Wh.debug(t),S=null,b=!1,"success"!==t.janus&&Wh.error("Ooops: "+t.error.code+" "+t.error.reason),i.success(),c&&e.destroyed()},error:function(t,r){Wh.error(t+":",r),S=null,b=!1,i.success(),c&&e.destroyed()}})}(i)},this.attach=function(e){!function(e){if(e=e||{},e.success="function"==typeof e.success?e.success:Wh.noop,e.error="function"==typeof e.error?e.error:Wh.noop,e.dataChannelOptions=e.dataChannelOptions||{ordered:!0},e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:Wh.noop,e.iceState="function"==typeof e.iceState?e.iceState:Wh.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:Wh.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:Wh.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:Wh.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:Wh.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:Wh.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:Wh.noop,e.ondata="function"==typeof e.ondata?e.ondata:Wh.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:Wh.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:Wh.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:Wh.noop,!b)return Wh.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var n=e.plugin;if(!n)return Wh.error("Invalid plugin"),void e.error("Invalid plugin");var o=e.opaqueId,i=e.loopIndex,a=e.token?e.token:h,c=Wh.randomString(12),d={janus:"attach",plugin:n,opaque_id:o,loop_index:i,transaction:c};a&&(d.token=a);m&&(d.apisecret=m);if(t)return R[c]=function(t){if(Wh.debug(t),"success"!==t.janus)return Wh.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var r=t.data.id;Wh.log("Created handle: "+r);var o={session:C,plugin:n,id:r,token:a,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannelOptions:e.dataChannelOptions,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return r},getPlugin:function(){return n},getVolume:function(){return V(r,!0)},getRemoteVolume:function(){return V(r,!0)},getLocalVolume:function(){return V(r,!1)},isAudioMuted:function(){return N(r,!1)},muteAudio:function(){return F(r,!1,!0)},unmuteAudio:function(){return F(r,!1,!1)},isVideoMuted:function(){return N(r,!0)},muteVideo:function(){return F(r,!0,!0)},unmuteVideo:function(){return F(r,!0,!1)},getBitrate:function(){return H(r)},send:function(e){I(r,e)},data:function(e){x(r,e)},dtmf:function(e){_(r,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){L(r,!0,e)},createAnswer:function(e){L(r,!1,e)},handleRemoteJsep:function(e){U(r,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){z(r,!0===e)},detach:function(e){j(r,e)}};w[r]=o,e.success(o)},d.session_id=S,void r.send(JSON.stringify(d));Wh.httpAPICall(s+"/"+S,{verb:"POST",withCredentials:p,body:d,success:function(t){if(Wh.debug(t),"success"!==t.janus)return Wh.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var r=t.data.id;Wh.log("Created handle: "+r);var o={session:C,plugin:n,id:r,token:a,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannelOptions:e.dataChannelOptions,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return r},getPlugin:function(){return n},getVolume:function(){return V(r,!0)},getRemoteVolume:function(){return V(r,!0)},getLocalVolume:function(){return V(r,!1)},isAudioMuted:function(){return N(r,!1)},muteAudio:function(){return F(r,!1,!0)},unmuteAudio:function(){return F(r,!1,!1)},isVideoMuted:function(){return N(r,!0)},muteVideo:function(){return F(r,!0,!0)},unmuteVideo:function(){return F(r,!0,!1)},getBitrate:function(){return H(r)},send:function(e){I(r,e)},data:function(e){x(r,e)},dtmf:function(e){_(r,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){L(r,!0,e)},createAnswer:function(e){L(r,!1,e)},handleRemoteJsep:function(e){U(r,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){z(r,!0===e)},detach:function(e){j(r,e)}};w[r]=o,e.success(o)},error:function(t,r){Wh.error(t+":",r),""===r?e.error(t+": Is the server down?"):e.error(t+": "+r)}})}(e)}}function qh(e,t,r){return t=t||"127.0.0.1",r=r||5060,"sip:".concat(e,"@").concat(t,":").concat(r)}function Bh(e){return void 0!==e.audio&&(e.audioSend=e.audioRecv=e.audio),void 0!==e.video&&(e.videoSend=e.videoRecv=e.video),e}async function $h(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new Error("Not support enumerateDevices(), plase use https to access.");let e=await navigator.mediaDevices.enumerateDevices();if(console.log("listDevices enumerateDevices find : ",null==e?void 0:e.length),e.length>0&&e[0].deviceId)return e;try{await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(t){try{await navigator.mediaDevices.getUserMedia({audio:!0})}catch(t){return e}}return navigator.mediaDevices.enumerateDevices()}Wh.useDefaultDependencies=function(e){var t=e&&e.fetch||fetch,r=e&&e.Promise||Promise,n=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new n(e,t)},extension:e&&e.extension||Jh,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||adapter,httpAPICall:function(e,n){var o={method:n.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===n.verb&&(o.headers["Content-Type"]="application/json"),void 0!==n.withCredentials&&(o.credentials=!0===n.withCredentials?"include":n.withCredentials?n.withCredentials:"omit"),n.body&&(o.body=JSON.stringify(n.body));var i=t(e,o).catch((function(e){return r.reject({message:"Probably a network error, is the server down?",error:e})}));if(n.timeout){var a=new r((function(e,t){var r=setTimeout((function(){return clearTimeout(r),t({message:"Request timed out",timeout:n.timeout})}),n.timeout)}));i=r.race([i,a])}return i.then((function(e){return e.ok?typeof n.success==typeof Wh.noop?e.json().then((function(e){try{n.success(e)}catch(e){Wh.error("Unhandled httpAPICall success callback error",e)}}),(function(t){return r.reject({message:"Failed to parse response body",error:t,response:e})})):void 0:r.reject({message:"API call failed",response:e})})).catch((function(e){typeof n.error==typeof Wh.noop&&n.error(e.message||"<< internal error >>",e)})),i}}},Wh.useOldDependencies=function(e){var t=e&&e.jQuery||jQuery,r=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new r(e,t)},isArray:function(e){return t.isArray(e)},extension:e&&e.extension||Jh,webRTCAdapter:e&&e.adapter||adapter,httpAPICall:function(e,r){var n=void 0!==r.body?{contentType:"application/json",data:JSON.stringify(r.body)}:{},o=void 0!==r.withCredentials?{xhrFields:{withCredentials:r.withCredentials}}:{};return t.ajax(t.extend(n,o,{url:e,type:r.verb,cache:!1,dataType:"json",async:r.async,timeout:r.timeout,success:function(e){typeof r.success==typeof Wh.noop&&r.success(e)},error:function(e,t,n){typeof r.error==typeof Wh.noop&&r.error(t,n)}}))}}},Wh.noop=function(){},Wh.dataChanDefaultLabel="JanusDataChannel",Wh.endOfCandidates=null,Wh.stopAllTracks=function(e){try{var t=e.getTracks();for(var r of t)Wh.log(r),r&&!0!==r.dontStop&&r.stop()}catch(e){}},Wh.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:Wh.noop,Wh.initDone)e.callback();else{if(void 0===console.log&&(console.log=function(){}),Wh.trace=Wh.noop,Wh.debug=Wh.noop,Wh.vdebug=Wh.noop,Wh.log=Wh.noop,Wh.warn=Wh.noop,Wh.error=Wh.noop,!0===e.debug||"all"===e.debug)Wh.trace=console.trace.bind(console),Wh.debug=console.debug.bind(console),Wh.vdebug=console.debug.bind(console),Wh.log=console.log.bind(console),Wh.warn=console.warn.bind(console),Wh.error=console.error.bind(console);else if(Array.isArray(e.debug))for(var t of e.debug)switch(t){case"trace":Wh.trace=console.trace.bind(console);break;case"debug":Wh.debug=console.debug.bind(console);break;case"vdebug":Wh.vdebug=console.debug.bind(console);break;case"log":Wh.log=console.log.bind(console);break;case"warn":Wh.warn=console.warn.bind(console);break;case"error":Wh.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+t+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}Wh.log("Initializing library");var r=e.dependencies||Wh.useDefaultDependencies();Wh.isArray=r.isArray,Wh.webRTCAdapter=r.webRTCAdapter,Wh.httpAPICall=r.httpAPICall,Wh.newWebSocket=r.newWebSocket,Wh.extension=r.extension,Wh.extension.init(),Wh.listDevices=function(e,t){e="function"==typeof e?e:Wh.noop,t||(t={audio:!0,video:!0}),Wh.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(t).then((function(t){if(!navigator.mediaDevices.enumerateDevices)return Wh.error("not support enumerateDevices()"),void e([]);navigator.mediaDevices.enumerateDevices().then((function(r){Wh.debug(r),e(r),Wh.stopAllTracks(t)})).catch((function(t){Wh.error(t),e([])}))})).catch((function(t){Wh.error(t),e([])})):(Wh.warn("navigator.mediaDevices unavailable"),e([]))},Wh.attachMediaStream=function(e,t){try{e.srcObject=t}catch(r){try{e.src=URL.createObjectURL(t)}catch(e){Wh.error("Error attaching stream to element",e)}}},Wh.reattachMediaStream=function(e,t){try{e.srcObject=t.srcObject}catch(r){try{e.src=t.src}catch(e){Wh.error("Error reattaching stream to element",e)}}};var n=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",o=window["on"+n];if(window.addEventListener(n,(function(){for(var e in Wh.log("Closing window"),Wh.sessions)Wh.sessions[e]&&Wh.sessions[e].destroyOnUnload&&(Wh.log("Destroying session "+e),Wh.sessions[e].destroy({unload:!0,notifyDestroyed:!1}));o&&"function"==typeof o&&o()})),Wh.safariVp8=!1,"safari"===Wh.webRTCAdapter.browserDetails.browser&&Wh.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){for(var i of RTCRtpSender.getCapabilities("video").codecs)if(i&&i.mimeType&&"video/vp8"===i.mimeType.toLowerCase()){Wh.safariVp8=!0;break}Wh.safariVp8?Wh.log("This version of Safari supports VP8"):Wh.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var a=new RTCPeerConnection({});a.createOffer({offerToReceiveVideo:!0}).then((function(e){Wh.safariVp8=-1!==e.sdp.indexOf("VP8"),Wh.safariVp8?Wh.log("This version of Safari supports VP8"):Wh.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),a.close(),a=null}))}if(Wh.unifiedPlan=!1,"firefox"===Wh.webRTCAdapter.browserDetails.browser&&Wh.webRTCAdapter.browserDetails.version>=59)Wh.unifiedPlan=!0;else if("chrome"===Wh.webRTCAdapter.browserDetails.browser&&Wh.webRTCAdapter.browserDetails.version>=72)Wh.unifiedPlan=!0;else if(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype){var s=new RTCPeerConnection;try{s.addTransceiver("audio"),Wh.unifiedPlan=!0}catch(e){}s.close()}else Wh.unifiedPlan=!1;Wh.initDone=!0,e.callback()}},Wh.isWebrtcSupported=function(){return!!window.RTCPeerConnection},Wh.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},Wh.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="",n=0;n<e;n++){var o=Math.floor(Math.random()*t.length);r+=t.charAt(o)}return r};class Kh{constructor(){n(this,"_listeners",{})}addListener(e,t,r){if("function"!=typeof t)return;let n,o=this._listeners;if("string"==typeof r&&r){if(/[^\w\-]/.test(r))throw"nonstandard key:"+r;t.hashCode=r,n=r}0!=e.indexOf("on")&&(e="on"+e),"object"!=typeof o[e]&&(o[e]={}),n=n||Yh(),t.hashCode=n,o[e][n]=t}removeListener(e,t){0!=e.indexOf("on")&&(e="on"+e);let r=this._listeners;if(r[e])if(t){let n;if("function"==typeof t&&(n=t.hashCode),"string"!=typeof n)return;r[e][n]&&delete r[e][n]}else r[e]={}}dispatch(e,t){"string"==typeof e&&(e=new Qh(e)),t=t||{};for(let r in t)e[r]=t[r];let r=this._listeners,n=e.type;if(e.target||(e.target=this),e.currentTarget=this,0!=n.indexOf("on")&&(n="on"+n),"object"==typeof r[n])for(let t in r[n])r[n][t].call(this,e);return e.returnValue}dispose(){this._listeners={}}}const Yh=function(){let e=1;return function(){return"SCSH_ID_"+(++e).toString()}}();class Qh{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.type=e,this.target=t,n(this,"returnValue",!0),n(this,"currentTarget",void 0)}}class Xh{constructor(e){this.handler=e,n(this,"msgActions",{}),this.msgActions[ba]=this.incomingcall.bind(this),this.msgActions[Sa]=this.ringing.bind(this),this.msgActions[wa]=this.accepted.bind(this),this.msgActions[Ca]=this.hangup.bind(this),this.msgActions[Ta]=this.hangupResult.bind(this),this.msgActions[Ra]=e=>this.registerResult(e,"fail"),this.msgActions[ka]=e=>this.registerResult(e,"succ"),this.msgActions[Pa]=this.unregisterResult.bind(this),this.msgActions[Ea]=this.callingResult.bind(this),this.msgActions[Da]=this.answerResult.bind(this),this.msgActions[Ia]=this.newAccepted.bind(this),this.msgActions[Aa]=this.updating.bind(this)}onMessage(t,r){console.log(t,r),r&&console.log("remote sdp = ",r.sdp);let n=t.error_code;if(n){let t=va.SHANDLE_FAILED_CODE[n]||"错误码："+n;return console.error("错误码："+n+","+t),this.handler.listener.dispatch(e.SoftHandlerEvent.ERROR,{code:n,message:t}),!1}let o=t.result;if(!o)return;let i=o.code;if(i&&200!=i){let t=va.SHANDLE_FAILED_CODE[i]||"错误码："+i;console.error("错误码："+i+","+t),this.handler.listener.dispatch(e.SoftHandlerEvent.ERROR,{code:i,message:t})}let a=o.event;if(!a)return;const s=this.msgActions[a];s?s(t,r):console.log("event："+a)}incomingcall(t,r){if(this.handler.calling)return;this.handler.remoteJsep=r,this.handler.calling=!0;var n=t.call_id,o=t.result;let i=null==o?void 0:o.type,a=null==o?void 0:o.username,s=this.handler.opts.configs.videoEnable;if(this.handler.remoteSipUri=a,"self_call_handle"===i)s=(null==o?void 0:o.video)&&"true"==s,this.handler.listener.dispatch(e.SoftHandlerEvent.IN_CALL_ANSWER,{callId:n,telNumber:a,displayName:null==o?void 0:o.displayname,video:s,audio:null==o?void 0:o.audio});else{var c={callId:n,telNumber:a,displayName:null==o?void 0:o.displayname,video:null==o?void 0:o.video,audio:null==o?void 0:o.audio,notifyType:i};this.handler.listener.dispatch(e.SoftHandlerEvent.IN_CALL,c)}console.log("振铃通知， telNumber = "+a+("self_call_handle"===i?", 自动应答":""))}ringing(t){var r=t.call_id;this.handler.listener.dispatch(e.SoftHandlerEvent.RINGING,{callId:r}),console.log("振铃通知， callId = "+r)}accepted(t,r){this.handler.handleRemoteJsep({jsep:r});var n=t.call_id,o=t.result,i=null==o?void 0:o.username;this.handler.callId=n,this.handler.listener.dispatch(e.SoftHandlerEvent.ACCEPTED,{callId:n,telNumber:i}),console.log("应答通知， callId = "+n+", telNumber"+i)}hangup(t){this.handler.asyncOps.opRejected("call"),this.handler.asyncOps.opRejected("new_call"),this.handler.calling=!1;var r=t.call_id,n=t.result;this.handler.callId=null,this.handler.listener.dispatch(e.SoftHandlerEvent.HANGUP,{callId:r,code:null==n?void 0:n.code,reason:null==n?void 0:n.reason}),console.log("挂断通知， callId = "+r),this.handler.clearCurrentCall()}hangupResult(t){this.handler.asyncOps.opResovled("hangup"),this.handler.asyncOps.opRejected("call"),this.handler.asyncOps.opRejected("new_call"),this.handler.calling=!1;var r=t.call_id,n=t.result;this.handler.callId=null,this.handler.listener.dispatch(e.SoftHandlerEvent.HANGUP_RESULT,{callId:r,code:null==n?void 0:n.code,reason:null==n?void 0:n.reason}),console.log("软手柄挂断通知， callId = "+r),this.handler.clearCurrentCall()}registerResult(t,r){var n=t.result;if("succ"==r){this.handler.asyncOps.opResovled("register");var o=null==n?void 0:n.username;this.handler.username=o,this.handler.listener.dispatch(e.SoftHandlerEvent.REG_RESULT,{event:"succ",telNumber:o}),console.log("注册成功通知")}else this.handler.asyncOps.opRejected("register"),this.handler.username=null,this.handler.listener.dispatch(e.SoftHandlerEvent.REG_RESULT,{event:"fail",code:null==n?void 0:n.code,reason:null==n?void 0:n.reason}),console.log("注册失败通知")}unregisterResult(t){this.handler.asyncOps.opResovled("unregister");var r=t.result,n=null==r?void 0:r.event,o=null==r?void 0:r.username;this.handler.username=null,this.handler.listener.dispatch(e.SoftHandlerEvent.UNREG_RESULT,{event:n,telNumber:o}),console.log("注销结果通知")}callingResult(t){var r=t.call_id;this.handler.listener.dispatch(e.SoftHandlerEvent.CALL_RESULT,{callId:r})}answerResult(t){this.handler.asyncOps.opResovled("call"),this.handler.asyncOps.opResovled("new_call"),this.handler.asyncOps.opResovled("accept");var r=t.call_id;this.handler.callId=r,this.handler.listener.dispatch(e.SoftHandlerEvent.ANSWER_RESULT,{callId:r})}newAccepted(t,r){this.handler.handleRemoteJsep({jsep:r}),this.handler.newAccepted(r);var n=t.call_id,o=t.result,i=null==o?void 0:o.username;this.handler.callId=n,this.handler.listener.dispatch(e.SoftHandlerEvent.ACCEPTED,{callId:n,telNumber:i}),console.log("返呼通知 - 对端应答，callId = "+n+", telNumber = "+i)}updating(e,t){let r=e.call_id;this.handler.callId=r,console.log("更新媒体，callId = "+r),this.handler.asyncOps.opResovled("update")}}class Zh{constructor(){n(this,"ops",{}),n(this,"timeout",1e4)}get operationing(){for(let e in this.ops)return!0;return!1}makeOpPromise(e){let t=this.ops[e];if(t)throw new Error("有任务正在运行，请勿重复执行");return t={},this.ops[e]=t,new Promise(((e,r)=>{t.resolve=e,t.reject=r}))}opResovled(e){let t=this.ops[e];if(t){try{t.resolve&&t.resolve()}catch(e){console.error(e)}delete this.ops[e]}}opRejected(e,t){let r=this.ops[e];if(r){try{r.reject&&r.reject(t)}catch(e){console.error(e)}delete this.ops[e]}}}var em=new WeakMap,tm=new WeakMap,rm=new WeakMap,nm=new WeakSet,om=new WeakSet;class im{get talking(){return!!this.callId}constructor(e){var t,r;this.opts=e,l(this,om),l(this,nm),d(this,em,{writable:!0,value:null}),d(this,tm,{writable:!0,value:void 0}),n(this,"username",void 0),n(this,"callId",void 0),n(this,"remoteSipUri",void 0),n(this,"currentMedia",void 0),n(this,"deviceConfig",void 0),n(this,"stream",null),n(this,"audioElm",void 0),n(this,"videoElm",void 0),n(this,"videoLocalElm",void 0),n(this,"remoteJsep",void 0),n(this,"backMedia",void 0),n(this,"calling",!1),n(this,"listener",new Kh),d(this,rm,{writable:!0,value:new Xh(this)}),n(this,"asyncOps",new Zh),this.audioElm=document.createElement("audio"),this.audioElm.autoplay=!0,this.audioElm.controls=!0,this.audioElm.style.display="none",document.body.appendChild(this.audioElm),this.videoElm=document.createElement("video"),this.videoElm.autoplay=!0,this.videoElm.setAttribute("playsinline",""),this.videoElm.setAttribute("webkit-playsinline",""),this.videoElm.setAttribute("x5-video-player-type","h5-page"),this.videoElm.controls=!1,null===(t=this.opts.configs.remoteVideo)||void 0===t||t.appendChild(this.videoElm),this.videoLocalElm=document.createElement("video"),this.videoLocalElm.autoplay=!0,this.videoElm.setAttribute("playsinline",""),this.videoElm.setAttribute("webkit-playsinline",""),this.videoElm.setAttribute("x5-video-player-type","h5-page"),this.videoLocalElm.controls=!1,this.videoLocalElm.muted=!0,null===(r=this.opts.configs.localVideo)||void 0===r||r.appendChild(this.videoLocalElm)}async initialize(){await s(this,nm,am).call(this),await s(this,om,sm).call(this)}handleRemoteJsep(e){var t;null===(t=o(this,tm))||void 0===t||t.handleRemoteJsep(e)}destroy(){let e=this;return new Promise((t=>{var r,n,a;(e.audioElm&&(e.audioElm.srcObject=null,document.body.removeChild(e.audioElm),delete e.audioElm),e.videoElm)&&(e.videoElm.srcObject=null,null===(n=e.opts.configs.remoteVideo)||void 0===n||n.removeChild(e.videoElm),delete e.videoElm);e.videoLocalElm&&(e.videoLocalElm.srcObject=null,null===(a=e.opts.configs.localVideo)||void 0===a||a.removeChild(e.videoLocalElm),delete e.videoLocalElm);null===(r=o(this,em))||void 0===r||r.destroy({success:()=>{i(e,em,null),t(),e.listener.dispose()},notifyDestroyed:!0})}))}send(e){return new Promise(((t,r)=>{o(this,tm)?o(this,tm).send(Object.assign(e,{success:t,error:r})):r(new Error("not initialized for sip-server."))}))}async register(e,t){var r,n;let o=qh(e,null===(r=this.opts.registerInfo)||void 0===r?void 0:r.sipServerIp,null===(n=this.opts.registerInfo)||void 0===n?void 0:n.sipServerPort);t=t||e;let i=this.asyncOps.makeOpPromise("register"),a={request:"register",proxy:o,display_name:t,username:e};try{return await this.send({message:a}),console.log("软手柄注册, sipUri = "+o+", 显示名称 = "+t+", 注册号码 = "+e),i}catch(e){this.asyncOps.opRejected("register",e)}}async unregister(){let e=this.asyncOps.makeOpPromise("unregister"),t={request:"unregister"};try{return await this.send({message:t}),console.log("软手柄注销, 注册号码 = "+this.username),e}catch(e){this.asyncOps.opRejected("unregister",e)}}call(e,t){var r,n,i;let a=this.asyncOps.makeOpPromise("call");Bh(t=t||{});let s=Object.assign(Object.assign({},ya),t);console.log(s);let c=(null===(r=t)||void 0===r?void 0:r.video)||(null===(n=t)||void 0===n?void 0:n.videoSend);return console.log("createOffer",s,this.deviceConfig),null===(i=o(this,tm))||void 0===i||i.createOffer({media:dm(s,this.deviceConfig),success:async r=>{let n={request:"call",uri:e,video:c?"1":"0"};try{await this.send({message:n,jsep:r}),console.log("软手柄呼叫，sipUri = "+e,r),console.log("local sdp = ",r.sdp),this.remoteSipUri=e,this.currentMedia=Object.assign({},t)}catch(e){this.asyncOps.opRejected("call",e)}},error:e=>{console.error(e),console.error(cm(e)),this.asyncOps.opRejected("call",e)}}),a}async newcall(e,t){let r=this.asyncOps.makeOpPromise("new_call");this.backMedia=t;let n={request:"new_call",uri:e,video:(null==t?void 0:t.video)||(null==t?void 0:t.videoSend)?"1":"0"};try{return await this.send({message:n}),console.log("软手柄返呼，sipUri = "+e),this.remoteSipUri=e,this.currentMedia=Object.assign({},t),r}catch(e){this.asyncOps.opRejected("new_call",e)}}newAccepted(e){var t;let r=this.backMedia||{};Bh(r);let n=Object.assign(Object.assign({},ya),r);e&&(e.sdp=e.sdp.replace(/profile-level-id=(\w+);/,"profile-level-id=42e00d;")),console.log("createAnswer",n,this.deviceConfig),null===(t=o(this,tm))||void 0===t||t.createAnswer({jsep:e,media:dm(n,this.deviceConfig),success:e=>{var t;null===(t=o(this,tm))||void 0===t||t.send({message:{request:"new_accept"},jsep:e}),console.log("返呼确认，local sdp = ",e.sdp)},error:e=>{console.error(e),console.error(cm(e))}})}answer(e){var t;let r=this.asyncOps.makeOpPromise("accept");if(!this.remoteJsep)throw new Error("not found call-info, nothing to answer");Bh(e=e||{});let n=Object.assign(Object.assign({},ya),e),i=this.remoteJsep;return this.remoteJsep=void 0,i&&(i.sdp=i.sdp.replace(/profile-level-id=(\w+);/,"profile-level-id=42e01f;")),console.log("createAnswer",n,this.deviceConfig),null===(t=o(this,tm))||void 0===t||t.createAnswer({jsep:i,media:dm(n,this.deviceConfig),success:async t=>{let r={request:"accept"};try{await this.send({message:r,jsep:t}),console.log("软手柄应答"),console.log("local sdp = ",t.sdp),this.currentMedia=Object.assign({},e)}catch(e){this.asyncOps.opRejected("accept",e)}},error:e=>{console.error(e),console.error(cm(e)),this.asyncOps.opRejected("accept",e)}}),r}updateMediaStream(){var e;if(!this.talking)throw new Error("当前不在通话中");let t=this.asyncOps.makeOpPromise("update"),r=Object.assign({},this.currentMedia);return console.log("createOffer",r,this.deviceConfig),null===(e=o(this,tm))||void 0===e||e.createOffer({media:dm(r,this.deviceConfig,!0),success:async e=>{let t={request:"update"};try{await this.send({message:t,jsep:e}),console.log("更新媒体流，sipUri = "+this.remoteSipUri,e),console.log("local sdp = ",e.sdp)}catch(e){this.asyncOps.opRejected("update",e)}},error:e=>{console.error(e),console.error(cm(e)),this.asyncOps.opRejected("update",e)}}),t}enableCamera(e){if(this.talking&&(!(t=this.currentMedia)||!(null!=t&&t.video||null!=t&&t.videoRecv||null!=t&&t.videoSend)))throw new Error("当前不是视频通话");var t;if(this.deviceConfig?this.deviceConfig.enableCamera=e:this.deviceConfig={enableCamera:e},this.talking&&this.stream){let t=this.stream.getVideoTracks();t.length>0&&(t[0].enabled=e,console.log("enableCamera",e,t[0]))}}hold(e){var t;let r={request:e};null===(t=o(this,tm))||void 0===t||t.send({message:r}),console.log("软手柄"+("hold"==e?"挂起":"取消挂起"))}async hangup(){let e=this.asyncOps.makeOpPromise("hangup"),t={request:"hangup"};try{return await this.send({message:t}),console.log("软手柄挂断"),e}catch(e){this.asyncOps.opRejected("hangup",e)}}clearCurrentCall(){this.remoteJsep=null,this.remoteSipUri=null,this.currentMedia=null}setVideoContainer(e){if(!e)throw new Error("opts can not be null");var t,r;e.remoteVideo?this.videoElm&&e.remoteVideo.appendChild(this.videoElm):this.videoElm&&(null===(t=this.opts.configs.remoteVideo)||void 0===t||t.removeChild(this.videoElm));(this.opts.configs.remoteVideo=e.remoteVideo,e.localVideo)?this.videoLocalElm&&e.localVideo.appendChild(this.videoLocalElm):this.videoLocalElm&&(null===(r=this.opts.configs.localVideo)||void 0===r||r.removeChild(this.videoLocalElm));this.opts.configs.localVideo=e.localVideo}listDevices(){return new Promise((e=>{Wh.listDevices((t=>e(t)))}))}setDevice(e){this.deviceConfig=e}setAudioOutputMuted(e){this.audioElm&&(this.audioElm.muted=e),this.videoElm&&(this.videoElm.muted=e)}isAudioOutputMuted(){var e,t;return!(null===(e=this.audioElm)||void 0===e||!e.muted||null===(t=this.videoElm)||void 0===t||!t.muted)}setAudioInputMuted(e){var t;null===(t=this.stream)||void 0===t||t.getAudioTracks().forEach((t=>t.enabled=!e))}isAudioInputMuted(){return!(!this.stream||!this.stream.getAudioTracks().every((e=>!e.enabled)))}}function am(){return new Promise(((e,t)=>{var r;Wh.init({debug:(null===(r=this.opts)||void 0===r?void 0:r.configs.debugJanus)||!1,dependencies:Wh.useDefaultDependencies({adapter:Ud}),callback:()=>{if(!Wh.isWebrtcSupported())return void t(new Error("不支持 WebRTC"));let r=this.opts.configs.janusUrl;i(this,em,new Wh({server:"https:"===location.protocol?r.replace("ws:","wss:"):r,success:()=>{console.log("Janus服务连接成功！"),e()},error:e=>{console.error("Janus服务连接失败或中断！",e),t(new Error("Janus服务连接失败或中断！"))},destroyed:()=>{console.log("Janus服务连接销毁！")}})),console.log("Janus 初始化成功")}})}))}function sm(){return new Promise(((t,r)=>{var n;let a=this;null===(n=o(this,em))||void 0===n||n.attach({plugin:"janus.plugin.sipserver",opaqueId:"sip-"+Wh.randomString(12),success:function(r){var n;(console.log("Janus插件初始化成功"),i(a,tm,r),t(),a.opts.configs.autoRegister)&&(a.register((null===(n=a.opts.registerInfo)||void 0===n?void 0:n.username)||""),a.listener.dispatch(e.SoftHandlerEvent.AUTO_REG,{}))},error:function(e){console.error("Janus插件初始化失败：".concat(e)),r("string"==typeof e?new Error(e):e)},consentDialog:function(e){console.log("Consent dialog should be "+(e?"on":"off")+" now")},iceState:function(e){console.log("ICE state changed to "+e)},mediaState:function(e,t){console.log("Janus "+(t?"started":"stopped")+" receiving our "+e)},webrtcState:function(e,t){console.log("Janus says our WebRTC PeerConnection is "+(e?"up":"down")+" now: "+t)},onmessage:(e,t)=>o(a,rm).onMessage(e,t),onremotestream:function(e){console.log("on remote stream",e),console.log(e.getTracks());let t=e.getAudioTracks();t.length>0&&(t[0].enabled=!0,console.log("remote audio tracks:",t));let r=e.getVideoTracks();a.videoElm&&(a.videoElm.srcObject&&(a.videoElm.srcObject=null),r.length>0&&(r[0].enabled=!0,console.log("remote video tracks:",r),Wh.attachMediaStream(a.videoElm,e),console.log("bind remote video"))),a.audioElm&&r.length<1&&(a.audioElm.srcObject&&(a.audioElm.srcObject=null),Wh.attachMediaStream(a.audioElm,e),console.log("bind remote audio"))},onlocalstream:function(e){console.log("on local stream",e),console.log(e.getTracks()),a.stream=e;let t=e.getAudioTracks();if(t.length>0&&(t[0].enabled=!0),a.videoLocalElm){let t=e.getVideoTracks();var r;if(t.length>0)t[0].enabled=function(e,t){if(void 0===e)return t;return e}(null===(r=a.deviceConfig)||void 0===r?void 0:r.enableCamera,!0),Wh.attachMediaStream(a.videoLocalElm,e),console.log("bind local video")}},oncleanup:function(){console.log("oncleanup"),a.stream=null,a.audioElm&&(a.audioElm.srcObject=null),a.videoElm&&(a.videoElm.srcObject=null),a.videoLocalElm&&(a.videoLocalElm.srcObject=null)}})}))}function cm(e){return e instanceof Error||e.message?e.message:"string"==typeof e?e:JSON.stringify(e)}function dm(e,t,r){let n={};return t&&(t.audioDeviceId&&(r&&(e.replaceAudio=!0),n.audio={deviceId:{exact:t.audioDeviceId}}),t.videoDeviceId&&(r&&(e.replaceVideo=!0),n.video={deviceId:{exact:t.videoDeviceId}}),void 0!==t.frontCamera&&(r&&(e.replaceVideo=!0),n.video={facingMode:t.frontCamera?"user":"environment"})),Object.assign(e,n)}let lm,um;var pm=new WeakMap,fm=new WeakMap;class hm{constructor(e){d(this,pm,{writable:!0,value:void 0}),d(this,fm,{writable:!0,value:0}),n(this,"voiceHeadphoneIndex",1),n(this,"voiceSpeakerIndex",2),i(this,pm,e),(void 0!==lm?Promise.resolve():$h().then((e=>{lm=[],um=[],e.forEach((e=>{"audioinput"==e.kind?lm.push(e):"videoinput"==e.kind&&um.push(e)})),console.log("a, v: ",lm.length,um.length)})).catch((e=>{console.error(e.name+": "+e.message)}))).then((()=>{lm.length<2?(this.voiceHeadphoneIndex=-1,this.voiceSpeakerIndex=-1):lm.length<3?(this.voiceHeadphoneIndex=0,this.voiceSpeakerIndex=1):(this.voiceHeadphoneIndex=1,this.voiceSpeakerIndex=2),this.hasMultiVideoDevice&&this.updateFrontCamera(!0)}))}get hasMultiVoiceDevice(){var e;return(null===(e=lm)||void 0===e?void 0:e.length)>1}get hasMultiVideoDevice(){var e;return(null===(e=um)||void 0===e?void 0:e.length)>1}get currentVoiceIndex(){return o(this,fm)}get currentVoiceDevId(){if(o(this,fm)<0||o(this,fm)>=lm.length)return"";return lm[o(this,fm)].deviceId}get currentFrontCamera(){var e;return!(null===(e=o(this,pm).deviceConfig)||void 0===e||!e.frontCamera)}async toggleVoiceDevice(){if(!this.hasMultiVoiceDevice)throw new Error("未找到多个麦克风无法进行切换");if(this.voiceHeadphoneIndex<0||this.voiceHeadphoneIndex>=lm.length||isNaN(this.voiceHeadphoneIndex))throw new Error("错误的 voiceHeadphoneIndex");if(this.voiceSpeakerIndex<0||this.voiceSpeakerIndex>=lm.length||isNaN(this.voiceSpeakerIndex))throw new Error("错误的 voiceSpeakerIndex");o(this,fm)!=this.voiceSpeakerIndex?i(this,fm,this.voiceSpeakerIndex):i(this,fm,this.voiceHeadphoneIndex);let e=lm[o(this,fm)];return o(this,pm).deviceConfig?o(this,pm).deviceConfig.audioDeviceId=e.deviceId:o(this,pm).deviceConfig={audioDeviceId:e.deviceId},o(this,pm).talking&&await o(this,pm).updateMediaStream(),[o(this,fm),e.deviceId,e.label]}async updateVoiceSpeaker(e){if(!this.hasMultiVoiceDevice)throw new Error("未找到多个音频设备无法进行切换");if(this.voiceHeadphoneIndex<0||this.voiceHeadphoneIndex>=lm.length||isNaN(this.voiceHeadphoneIndex))throw new Error("错误的 voiceHeadphoneIndex");if(this.voiceSpeakerIndex<0||this.voiceSpeakerIndex>=lm.length||isNaN(this.voiceSpeakerIndex))throw new Error("错误的 voiceSpeakerIndex");i(this,fm,e?this.voiceSpeakerIndex:this.voiceHeadphoneIndex);let t=lm[o(this,fm)];o(this,pm).deviceConfig?o(this,pm).deviceConfig.audioDeviceId=t.deviceId:o(this,pm).deviceConfig={audioDeviceId:t.deviceId},console.log("updateVoiceSpeaker:",o(this,pm).deviceConfig),o(this,pm).talking&&await o(this,pm).updateMediaStream()}async updateFrontCamera(e){if(!this.hasMultiVideoDevice)throw new Error("未找到多个摄像头无法进行切换");o(this,pm).deviceConfig?o(this,pm).deviceConfig.frontCamera=e:o(this,pm).deviceConfig={frontCamera:e},console.log("updateFrontCamera:",o(this,pm).deviceConfig),o(this,pm).talking&&await o(this,pm).updateMediaStream()}async enableCamera(e){o(this,pm).enableCamera(e)}}var mm=new WeakMap,vm=new WeakMap,gm=new WeakMap;class ym{get version(){return"1.2.20"}get registed(){var e;return!(null===(e=o(this,vm))||void 0===e||!e.username)}get username(){return o(this,vm).username}get talking(){return o(this,vm).talking}get callId(){return o(this,vm).callId}constructor(e){if(d(this,mm,{writable:!0,value:void 0}),d(this,vm,{writable:!0,value:void 0}),d(this,gm,{writable:!0,value:void 0}),!e)throw new Error("WebRtcSoftHandler 的参数 opts 不能为空");i(this,mm,Object.assign(Object.assign({},ga),e)),function(){let e=window;if(null==e.checkAudioDevicesStatus||null==e.hasAudioInputDevices)if(e.checkAudioDevicesStatus=!1,e.hasAudioInputDevices=!1,navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){var t=(new Date).getTime();navigator.mediaDevices.enumerateDevices().then((function(r){r.forEach((function(t){"audioinput"==t.kind&&(e.hasAudioInputDevices=!0)})),e.checkAudioDevicesStatus=!0,console.log("检查音频输入设备总计耗时: "+((new Date).getTime()-t)+"ms")})).catch((function(e){console.error(e.name+": "+e.message)}))}else console.error("Not support enumerateDevices(), plase use https to access.")}(),i(this,vm,new im(o(this,mm))),i(this,gm,new hm(o(this,vm)))}initialize(){return o(this,vm).initialize()}register(e){return"string"==typeof e&&(e={username:e}),o(this,vm).register(e.username,e.displayName)}unregister(){return o(this,vm).unregister()}destroy(){return o(this,vm).destroy()}call(e,t){var r,n;let i=qh(e,null===(r=o(this,mm).registerInfo)||void 0===r?void 0:r.sipServerIp,null===(n=o(this,mm).registerInfo)||void 0===n?void 0:n.sipServerPort);return o(this,vm).call(i,t)}newcall(e,t){var r,n;let i=qh(e,null===(r=o(this,mm).registerInfo)||void 0===r?void 0:r.sipServerIp,null===(n=o(this,mm).registerInfo)||void 0===n?void 0:n.sipServerPort);return o(this,vm).newcall(i,t)}answer(e){return o(this,vm).answer(e)}hangup(){return o(this,vm).hangup()}on(e,t,r){o(this,vm).listener.addListener(e,t,r)}off(e,t){o(this,vm).listener.removeListener(e,t)}setVideoContainer(e){o(this,vm).setVideoContainer(e)}listDevices(){return o(this,vm).listDevices()}setDevice(e){console.warn("此接口已过时，请使用 softHandler.deviceControl.xxx 进行设备控制"),o(this,vm).setDevice(e)}get audioOutputMuted(){return o(this,vm).isAudioOutputMuted()}set audioOutputMuted(e){o(this,vm).setAudioOutputMuted(e)}get audioInputMuted(){return o(this,vm).isAudioInputMuted()}set audioInputMuted(e){o(this,vm).setAudioInputMuted(e)}get deviceControl(){return o(this,gm)}}e.createSoftHandler=async function(e){let t=new ym(e);return await t.initialize(),t},e.listMediaDevices=async function(){return $h()}}));
